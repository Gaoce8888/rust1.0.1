<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æœç³»ç»Ÿ - å‰ç«¯é›†æˆæŒ‡å—</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; border-radius: 10px; margin-bottom: 30px; }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        h2 { color: #667eea; margin: 30px 0 20px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .section { background: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .code-block { background: #282c34; color: #abb2bf; padding: 20px; border-radius: 5px; overflow-x: auto; margin: 15px 0; font-family: 'Consolas', 'Monaco', monospace; }
        .highlight { background: #ffeaa7; padding: 2px 5px; border-radius: 3px; }
        .warning { background: #ff7675; color: white; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .success { background: #00b894; color: white; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .feature-card { background: #f8f9fa; padding: 20px; border-radius: 5px; border: 1px solid #dee2e6; }
        .feature-card h3 { color: #764ba2; margin-bottom: 10px; }
        ul { padding-left: 20px; margin: 10px 0; }
        .btn { display: inline-block; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; margin: 10px 5px; }
        .btn:hover { background: #764ba2; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å‰ç«¯é›†æˆæŒ‡å—</h1>
            <p class="version">é€‚ç”¨äºå®¢æœç³»ç»Ÿ v2.0</p>
            <p>Reactå®¢æœç«¯ + Reactå®¢æˆ·ç«¯å®Œæ•´å¯¹æ¥è¯´æ˜</p>
        </header>

        <div class="section">
            <h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
            <p>ç³»ç»ŸåŒ…å«ä¸¤ä¸ªç‹¬ç«‹çš„å‰ç«¯åº”ç”¨ï¼š</p>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>å®¢æœç«¯ (react-kefu)</h3>
                    <p>ä½ç½®ï¼š<code>/static/react-kefu/</code></p>
                    <ul>
                        <li>å®¢æœäººå‘˜ä½¿ç”¨çš„ç®¡ç†ç•Œé¢</li>
                        <li>æ”¯æŒå¤šå®¢æˆ·ä¼šè¯ç®¡ç†</li>
                        <li>å®æ—¶æ¶ˆæ¯æ¨é€</li>
                        <li>å®¢æˆ·ä¿¡æ¯å±•ç¤º</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3>å®¢æˆ·ç«¯ (react-kehu)</h3>
                    <p>ä½ç½®ï¼š<code>/static/react-kehu/</code></p>
                    <ul>
                        <li>å®¢æˆ·ä½¿ç”¨çš„èŠå¤©ç•Œé¢</li>
                        <li>æ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶æ¶ˆæ¯</li>
                        <li>æ¶ˆæ¯çŠ¶æ€æ˜¾ç¤º</li>
                        <li>å“åº”å¼è®¾è®¡</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“¡ WebSocket è¿æ¥é…ç½®</h2>
            <p>ä¸¤ä¸ªå‰ç«¯éƒ½éœ€è¦å»ºç«‹WebSocketè¿æ¥ï¼š</p>
            
            <h3>å®¢æœç«¯è¿æ¥</h3>
            <div class="code-block">
// /static/react-kefu/src/hooks/useEnterpriseWebSocket.js
const ws = new WebSocket(`ws://localhost:3001/ws/${kefuId}`);

ws.onopen = () => {
    console.log('å®¢æœç«¯WebSocketè¿æ¥æˆåŠŸ');
    // å‘é€è®¤è¯ä¿¡æ¯
    ws.send(JSON.stringify({
        type: 'auth',
        data: {
            user_type: 'kefu',
            kefu_id: kefuId
        }
    }));
};

ws.onmessage = (event) => {
    const message = JSON.parse(event.data);
    // å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
    handleIncomingMessage(message);
};</div>

            <h3>å®¢æˆ·ç«¯è¿æ¥</h3>
            <div class="code-block">
// /static/react-kehu/src/App.jsx
const ws = new WebSocket(`ws://localhost:3001/ws/${userId}`);

ws.onopen = () => {
    console.log('å®¢æˆ·ç«¯WebSocketè¿æ¥æˆåŠŸ');
    // å‘é€è®¤è¯ä¿¡æ¯
    ws.send(JSON.stringify({
        type: 'auth',
        data: {
            user_type: 'customer',
            user_id: userId
        }
    }));
};</div>
        </div>

        <div class="section">
            <h2>ğŸ”Œ API é›†æˆè¦ç‚¹</h2>
            
            <h3>1. å®¢æœç™»å½•é›†æˆ</h3>
            <div class="code-block">
// å®¢æœç™»å½•
async function kefuLogin(username, password) {
    const response = await fetch('/api/auth/kefu/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
    });
    
    const result = await response.json();
    if (result.success) {
        // ä¿å­˜sessionä¿¡æ¯
        localStorage.setItem('kefu_session', result.session_id);
        localStorage.setItem('kefu_id', result.kefu_info.kefu_id);
    }
    return result;
}</div>

            <h3>2. æ¶ˆæ¯å‘é€é›†æˆ</h3>
            <div class="code-block">
// å‘é€æ¶ˆæ¯é€šè¿‡WebSocket
function sendMessage(toUserId, content, msgType = 'text') {
    const message = {
        type: 'message',
        data: {
            to_user_id: toUserId,
            content: content,
            msg_type: msgType,
            timestamp: new Date().toISOString()
        }
    };
    
    ws.send(JSON.stringify(message));
}</div>

            <h3>3. æ–‡ä»¶ä¸Šä¼ é›†æˆ</h3>
            <div class="code-block">
// æ–‡ä»¶ä¸Šä¼ 
async function uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('category', 'chat');
    
    const response = await fetch('/api/files/upload', {
        method: 'POST',
        body: formData
    });
    
    const result = await response.json();
    return result.url; // è¿”å›æ–‡ä»¶URLç”¨äºå‘é€
}</div>
        </div>

        <div class="section">
            <h2>ğŸ¨ UIç»„ä»¶è¯´æ˜</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>å®¢æœç«¯ä¸»è¦ç»„ä»¶</h3>
                    <ul>
                        <li><code>ConversationList</code> - ä¼šè¯åˆ—è¡¨</li>
                        <li><code>ChatWindow</code> - èŠå¤©çª—å£</li>
                        <li><code>UserInfo</code> - ç”¨æˆ·ä¿¡æ¯é¢æ¿</li>
                        <li><code>QuickReply</code> - å¿«æ·å›å¤</li>
                        <li><code>TransferDialog</code> - è½¬æ¥å¯¹è¯æ¡†</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h3>å®¢æˆ·ç«¯ä¸»è¦ç»„ä»¶</h3>
                    <ul>
                        <li><code>ChatPanel</code> - èŠå¤©é¢æ¿</li>
                        <li><code>MessageList</code> - æ¶ˆæ¯åˆ—è¡¨</li>
                        <li><code>InputArea</code> - è¾“å…¥åŒºåŸŸ</li>
                        <li><code>FileUploader</code> - æ–‡ä»¶ä¸Šä¼ </li>
                        <li><code>EmojiPicker</code> - è¡¨æƒ…é€‰æ‹©</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>âš¡ æ–°åŠŸèƒ½é›†æˆ</h2>
            
            <h3>å®¢æœåˆ†é…ç³»ç»Ÿ</h3>
            <div class="code-block">
// è‡ªåŠ¨åˆ†é…å®¢æœ
async function requestKefu(customerId) {
    const response = await fetch(`/api/kefu/assign/${customerId}`, {
        method: 'POST'
    });
    
    const result = await response.json();
    if (result.success) {
        console.log(`å·²åˆ†é…å®¢æœ: ${result.kefu_id}`);
        // æ›´æ–°UIæ˜¾ç¤ºåˆ†é…çš„å®¢æœ
        updateAssignedKefu(result.kefu_id);
    }
}</div>

            <h3>ç³»ç»Ÿç›‘æ§é›†æˆ</h3>
            <div class="code-block">
// è·å–ç³»ç»ŸçŠ¶æ€
async function getSystemStatus() {
    const [health, wsStats] = await Promise.all([
        fetch('/api/system/health').then(r => r.json()),
        fetch('/api/stats/websocket').then(r => r.json())
    ]);
    
    // æ›´æ–°ä»ªè¡¨æ¿
    updateDashboard({
        health: health.status,
        connections: wsStats.total_connections,
        activeUsers: wsStats.active_connections
    });
}</div>
        </div>

        <div class="section">
            <h2>ğŸ”§ é…ç½®è¯´æ˜</h2>
            
            <h3>ç¯å¢ƒå˜é‡é…ç½®</h3>
            <div class="code-block">
// .env æ–‡ä»¶
REACT_APP_WS_URL=ws://localhost:3001
REACT_APP_API_URL=http://localhost:3001
REACT_APP_FILE_UPLOAD_LIMIT=10485760  # 10MB</div>

            <h3>ä»£ç†é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</h3>
            <div class="code-block">
// package.json
{
  "proxy": "http://localhost:3001"
}</div>

            <h3>ç”Ÿäº§ç¯å¢ƒé…ç½®</h3>
            <div class="code-block">
// nginx.conf
location /ws {
    proxy_pass http://backend:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
}

location /api {
    proxy_pass http://backend:3001;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}</div>
        </div>

        <div class="section">
            <h2>ğŸ“‹ æ£€æŸ¥æ¸…å•</h2>
            <ul style="list-style-type: none; padding: 0;">
                <li>âœ… WebSocketè¿æ¥æ­£å¸¸å»ºç«‹</li>
                <li>âœ… æ¶ˆæ¯æ”¶å‘åŠŸèƒ½æ­£å¸¸</li>
                <li>âœ… æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ­£å¸¸</li>
                <li>âœ… å®¢æœç™»å½•è®¤è¯æ­£å¸¸</li>
                <li>âœ… å®¢æœåˆ†é…åŠŸèƒ½æ­£å¸¸</li>
                <li>âœ… å¿ƒè·³æœºåˆ¶æ­£å¸¸å·¥ä½œ</li>
                <li>âœ… æ–­çº¿é‡è¿æœºåˆ¶æ­£å¸¸</li>
                <li>âœ… ç³»ç»Ÿç›‘æ§æ•°æ®æ­£å¸¸</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸš¨ å¸¸è§é—®é¢˜</h2>
            
            <div class="warning">
                <strong>WebSocketè¿æ¥å¤±è´¥</strong>
                <p>æ£€æŸ¥ï¼š1) åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ 2) ç«¯å£æ˜¯å¦æ­£ç¡® 3) é˜²ç«å¢™è®¾ç½®</p>
            </div>
            
            <div class="warning">
                <strong>è·¨åŸŸé—®é¢˜</strong>
                <p>å¼€å‘ç¯å¢ƒä½¿ç”¨proxyé…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒé…ç½®nginxåå‘ä»£ç†</p>
            </div>
            
            <div class="success">
                <strong>æç¤º</strong>
                <p>å»ºè®®ä½¿ç”¨Chrome DevToolsçš„Networké¢æ¿ç›‘æ§WebSocketæ¶ˆæ¯</p>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“š ç›¸å…³æ–‡æ¡£</h2>
            <a href="backend-api-latest.html" class="btn">åç«¯APIæ–‡æ¡£</a>
            <a href="websocket-protocol.html" class="btn">WebSocketåè®®æ–‡æ¡£</a>
            <a href="deployment.html" class="btn">éƒ¨ç½²æŒ‡å—</a>
        </div>
    </div>
</body>
</html>