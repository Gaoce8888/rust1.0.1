[2m2025-07-18T04:33:18.958529Z[0m [32m INFO[0m [2mkefu_system[0m[2m:[0m 启动企业级客服系统...
[2m2025-07-18T04:33:18.958701Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 配置加载成功: 企业级客服系统 v2.1.0
[2m2025-07-18T04:33:18.961844Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池初始化成功 - URL: redis://127.0.0.1:6379, 最大连接数: 32, 最小空闲: Some(8)
[2m2025-07-18T04:33:18.961896Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m Redis连接池初始化成功: redis://127.0.0.1:6379
[2m2025-07-18T04:33:18.961909Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 连接池配置: 最大连接数=0, 当前连接数=0
[2m2025-07-18T04:33:18.961929Z[0m [32m INFO[0m [2mkefu_system::storage[0m[2m:[0m 🚀 企业级存储初始化: 基础路径=/root/企业级客服系统/服务端-后端rust/data, Sled路径=/root/企业级客服系统/服务端-后端rust/data/sled_db
[2m2025-07-18T04:33:18.964010Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/1, 利用率: 0.0%
[2m2025-07-18T04:33:18.968352Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 本地存储初始化成功: ./data
[2m2025-07-18T04:33:18.968384Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 文件管理器初始化成功: ./data/blobs
[2m2025-07-18T04:33:18.968626Z[0m [32m INFO[0m [2mkefu_system::html_template_manager[0m[2m:[0m 加载了 0 个HTML模板
[2m2025-07-18T04:33:18.968643Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m HTML模板管理器初始化成功
[2m2025-07-18T04:33:18.968692Z[0m [32m INFO[0m [2mkefu_system::user_manager[0m[2m:[0m ✅ 成功加载用户数据，共3个用户
[2m2025-07-18T04:33:18.969537Z[0m [32m INFO[0m [2mkefu_system::user_manager[0m[2m:[0m ✅ Redis连接成功
[2m2025-07-18T04:33:18.969563Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 用户管理器初始化成功
[2m2025-07-18T04:33:18.969574Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 🎤 语音消息管理器初始化成功
[2m2025-07-18T04:33:19.050124Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 🤖 AI管理器初始化成功
[2m2025-07-18T04:33:19.050144Z[0m [32m INFO[0m [2mkefu_system::auth::kefu_auth[0m[2m:[0m 🔐 初始化默认客服账号
[2m2025-07-18T04:33:19.050254Z[0m [32m INFO[0m [2mkefu_system::auth::kefu_auth[0m[2m:[0m ✅ 默认客服账号初始化完成
[2m2025-07-18T04:33:19.050257Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 🔐 客服认证管理器初始化成功
[2m2025-07-18T04:33:19.050290Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m ✅ 基于会话的在线状态检测已启用 - 基于活动时间判断
[2m2025-07-18T04:33:19.050296Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 🤖 AI处理器已启动，开始处理任务队列
[2m2025-07-18T04:33:19.050299Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m ✅ 会话清理任务已启动，每小时清理一次过期会话
[2m2025-07-18T04:33:19.050320Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🚀 企业级客服系统启动成功！
[2m2025-07-18T04:33:19.050323Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 📡 HTTP服务器地址: http://0.0.0.0:6006
[2m2025-07-18T04:33:19.050325Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔌 WebSocket地址: ws://0.0.0.0:6006/ws
[2m2025-07-18T04:33:19.050327Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 📚 API文档: http://0.0.0.0:6006/api-docs
[2m2025-07-18T04:33:19.050329Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🎯 前端地址: http://0.0.0.0:6006
[2m2025-07-18T04:33:19.050331Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 💡 如果浏览器没有自动打开，请手动访问上述地址
[2m2025-07-18T04:33:19.050343Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🌐 正在打开浏览器: http://localhost:6006
[2m2025-07-18T04:33:19.051633Z[0m [32m INFO[0m [2mkefu_system::server::components[0m[2m:[0m 🧹 开始定期清理过期会话...
[2m2025-07-18T04:33:19.051661Z[0m [32m INFO[0m [2mkefu_system::user_manager[0m[2m:[0m 🧹 Redis自动处理过期会话，无需手动清理
[2m2025-07-18T04:33:19.052829Z[0m [32m INFO[0m [1mServer::run[0m[1m{[0m[3maddr[0m[2m=[0m0.0.0.0:6006[1m}[0m[2m:[0m [2mwarp::server[0m[2m:[0m listening on http://0.0.0.0:6006
[2m2025-07-18T04:33:19.184906Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:19.185057Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752813016762", "user_type": "kehu", "session_id": "session_1752813016773"}
[2m2025-07-18T04:33:19.185081Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 202.415µs | 来源: Some(127.0.0.1:61678)
[2m2025-07-18T04:33:19.185123Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813016762, 用户名=customer_1752813016762, 类型=Kehu
[2m2025-07-18T04:33:19.185133Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813016762, user_name=customer_1752813016762, user_type=Kehu
[2m2025-07-18T04:33:19.185139Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813016762
[2m2025-07-18T04:33:19.185143Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752813016762
[2m2025-07-18T04:33:19.185145Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752813016762
[2m2025-07-18T04:33:19.186720Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752813016762
[2m2025-07-18T04:33:19.186730Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752813016762
[2m2025-07-18T04:33:19.186740Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752813016762
[2m2025-07-18T04:33:19.186743Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752813016762
[2m2025-07-18T04:33:19.186746Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:19.186749Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752813016762
[2m2025-07-18T04:33:19.186950Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752813016762
[2m2025-07-18T04:33:19.186987Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752813016762启动Redis频道订阅: ["user:customer_1752813016762:messages", "user:customer_1752813016762:notifications", "system:broadcasts", "session:customer_1752813016762:events"]
[2m2025-07-18T04:33:19.187523Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: user:customer_1752813016762:messages
[2m2025-07-18T04:33:19.187728Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: user:customer_1752813016762:notifications
[2m2025-07-18T04:33:19.188127Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:19.188296Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: session:customer_1752813016762:events
[2m2025-07-18T04:33:19.189831Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:19.189838Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752813016762请求分配客服
[2m2025-07-18T04:33:19.189842Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 没有可用客服，客户 customer_1752813016762 暂时无法分配
[2m2025-07-18T04:33:19.189845Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752813016762
[2m2025-07-18T04:33:19.189881Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752813016762
[2m2025-07-18T04:33:19.189901Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Welcome
[2m2025-07-18T04:33:19.189923Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Welcome
[2m2025-07-18T04:33:19.189925Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:19.189935Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:19.189937Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=History
[2m2025-07-18T04:33:19.189940Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=History
[2m2025-07-18T04:33:19.189942Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:19.189946Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:19.189948Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:19.189957Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
/usr/bin/xdg-open: 882: x-www-browser: not found
/usr/bin/xdg-open: 882: firefox: not found
/usr/bin/xdg-open: 882: iceweasel: not found
/usr/bin/xdg-open: 882: seamonkey: not found
/usr/bin/xdg-open: 882: mozilla: not found
/usr/bin/xdg-open: 882: epiphany: not found
/usr/bin/xdg-open: 882: konqueror: not found
/usr/bin/xdg-open: 882: chromium: not found
/usr/bin/xdg-open: 882: chromium-browser: not found
/usr/bin/xdg-open: 882: google-chrome: not found
/usr/bin/xdg-open: 882: www-browser: not found
/usr/bin/xdg-open: 882: links2: not found
/usr/bin/xdg-open: 882: elinks: not found
/usr/bin/xdg-open: 882: links: not found
/usr/bin/xdg-open: 882: lynx: not found
/usr/bin/xdg-open: 882: w3m: not found
xdg-open: no method available for opening 'http://localhost:6006'
[2m2025-07-18T04:33:22.599703Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:22.599805Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813016772", "user_type": "kehu", "user_id": "customer_1752813016762"}
[2m2025-07-18T04:33:22.599819Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 137.233µs | 来源: Some(127.0.0.1:61867)
[2m2025-07-18T04:33:22.599855Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813016762, 用户名=customer_1752813016762, 类型=Kehu
[2m2025-07-18T04:33:22.599861Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813016762, user_name=customer_1752813016762, user_type=Kehu
[2m2025-07-18T04:33:22.599866Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813016762
[2m2025-07-18T04:33:22.599878Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752813016762
[2m2025-07-18T04:33:22.599880Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752813016762
[2m2025-07-18T04:33:22.601534Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752813016762
[2m2025-07-18T04:33:22.601542Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752813016762
[2m2025-07-18T04:33:22.601548Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752813016762
[2m2025-07-18T04:33:22.601551Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752813016762
[2m2025-07-18T04:33:22.601554Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:22.601557Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752813016762
[2m2025-07-18T04:33:22.601577Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752813016762
[2m2025-07-18T04:33:22.601600Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752813016762启动Redis频道订阅: ["user:customer_1752813016762:messages", "user:customer_1752813016762:notifications", "system:broadcasts", "session:customer_1752813016762:events"]
[2m2025-07-18T04:33:22.602250Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: user:customer_1752813016762:messages
[2m2025-07-18T04:33:22.602462Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: user:customer_1752813016762:notifications
[2m2025-07-18T04:33:22.602618Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:22.602887Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: session:customer_1752813016762:events
[2m2025-07-18T04:33:22.604351Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:22.604365Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752813016762请求分配客服
[2m2025-07-18T04:33:22.604368Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 没有可用客服，客户 customer_1752813016762 暂时无法分配
[2m2025-07-18T04:33:22.604371Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752813016762
[2m2025-07-18T04:33:22.604409Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752813016762
[2m2025-07-18T04:33:22.604420Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Welcome
[2m2025-07-18T04:33:22.604440Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Welcome
[2m2025-07-18T04:33:22.604442Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:22.604452Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:22.604454Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=History
[2m2025-07-18T04:33:22.604457Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=History
[2m2025-07-18T04:33:22.604466Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:22.604469Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:22.604471Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:22.604477Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:24.611518Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:24.611638Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752813016762", "session_id": "session_1752813026801"}
[2m2025-07-18T04:33:24.611653Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 147.801µs | 来源: Some(127.0.0.1:61937)
[2m2025-07-18T04:33:24.611689Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813016762, 用户名=customer_1752813016762, 类型=Kehu
[2m2025-07-18T04:33:24.611693Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813016762, user_name=customer_1752813016762, user_type=Kehu
[2m2025-07-18T04:33:24.611697Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813016762
[2m2025-07-18T04:33:24.611701Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752813016762
[2m2025-07-18T04:33:24.611703Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752813016762
[2m2025-07-18T04:33:24.613219Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752813016762
[2m2025-07-18T04:33:24.613228Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752813016762
[2m2025-07-18T04:33:24.613236Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752813016762
[2m2025-07-18T04:33:24.613239Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752813016762
[2m2025-07-18T04:33:24.613242Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:24.613244Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752813016762
[2m2025-07-18T04:33:24.613255Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752813016762
[2m2025-07-18T04:33:24.613275Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752813016762启动Redis频道订阅: ["user:customer_1752813016762:messages", "user:customer_1752813016762:notifications", "system:broadcasts", "session:customer_1752813016762:events"]
[2m2025-07-18T04:33:24.613992Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: user:customer_1752813016762:messages
[2m2025-07-18T04:33:24.614187Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: user:customer_1752813016762:notifications
[2m2025-07-18T04:33:24.614359Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:24.614539Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813016762已订阅Redis频道: session:customer_1752813016762:events
[2m2025-07-18T04:33:24.615858Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:24.616638Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752813016762请求分配客服
[2m2025-07-18T04:33:24.616643Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 没有可用客服，客户 customer_1752813016762 暂时无法分配
[2m2025-07-18T04:33:24.616646Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752813016762
[2m2025-07-18T04:33:24.616680Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752813016762
[2m2025-07-18T04:33:24.616690Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Welcome
[2m2025-07-18T04:33:24.616709Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Welcome
[2m2025-07-18T04:33:24.616712Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:24.616721Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:24.616723Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=History
[2m2025-07-18T04:33:24.616727Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=History
[2m2025-07-18T04:33:24.616728Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:24.616732Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:24.616734Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:24.616740Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:35.891046Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:35.891261Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813215883", "user_id": "test_customer_123", "timestamp": "2025-07-18T04:33:35.883Z", "user_type": "customer", "user_name": "test_customer_123"}
[2m2025-07-18T04:33:35.891270Z[0m [33m WARN[0m [2mkefu_system::errors[0m[2m:[0m 🔗 WebSocket参数错误 - user_type: 未知的用户类型: customer
[2m2025-07-18T04:33:35.891774Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 400 | 耗时: 740.768µs | 来源: Some(127.0.0.1:54919)
[2m2025-07-18T04:33:38.263478Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:38.263592Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "user_id": "kf001", "session_id": "session_1752813218258", "connection_id": "ent_conn_1752813218231_z3idpocgx1o", "quality": "high_performance", "session": "ent_session_1752813218231_t9ajbk8sfhm", "user_type": "kefu", "timestamp": "2025-07-18T04:33:38.258Z", "user_name": "kf001"}
[2m2025-07-18T04:33:38.263613Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 172.258µs | 来源: Some(127.0.0.1:62451)
[2m2025-07-18T04:33:38.263651Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:38.263657Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:38.263673Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:38.263678Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:38.263680Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:38.265142Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:38.265158Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:38.265165Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:38.265168Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:38.265172Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:38.265174Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:38.265177Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:38.265224Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:38.265248Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:38.265254Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:38.265830Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:38.266056Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:38.266280Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:38.266445Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:38.266829Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:38.266851Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:38.267904Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:38.268302Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:38.268309Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:38.268313Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:38.268315Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:38.268380Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:38.268390Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:38.268409Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:38.268412Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268421Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268433Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:38.268437Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:38.268439Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:38.268442Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:38.268444Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268451Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268453Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:38.268457Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:38.268459Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268467Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268469Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.268473Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.276431Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:38.276517Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:33:38.259Z", "quality": "high_performance", "user_type": "kefu", "priority": "high", "session_id": "session_1752813218259", "user_id": "kf001", "user_name": "kf001", "connection_id": "ent_conn_1752813218231_z3idpocgx1o", "session": "ent_session_1752813218231_t9ajbk8sfhm"}
[2m2025-07-18T04:33:38.276529Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 116.04µs | 来源: Some(127.0.0.1:62453)
[2m2025-07-18T04:33:38.276566Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:38.276569Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:38.276574Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:38.276578Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:38.276580Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:38.277791Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:38.277809Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:38.277816Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:38.277819Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:38.277823Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:38.277825Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:38.277827Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:38.277891Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:38.277911Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:38.277909Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:38.278451Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:38.278659Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:38.278910Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:38.279060Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:38.279331Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:38.279385Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280307Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:38.280670Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:38.280676Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:38.280679Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:38.280682Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:38.280722Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:38.280734Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:38.280752Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:38.280754Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280764Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280766Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:38.280770Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:38.280772Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:38.280775Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:38.280777Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280784Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280786Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:38.280789Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:38.280791Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280808Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280810Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:38.280814Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:40.299570Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:40.300322Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:40.300330Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813220285_cg1s7qs9","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:40.285Z"}'
[2m2025-07-18T04:33:40.300876Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:40.300883Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:40.300976Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:40.300978Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:40.300982Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:40.300986Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:40.300989Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:40.300992Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:40.301016Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:40.301024Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:40.301041Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:40.301054Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:40.301080Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:40.301126Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:40.301410Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:40.301417Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813220285_awg17af4","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:40.285Z"}'
[2m2025-07-18T04:33:40.301780Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:40.301798Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:40.301862Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:40.301864Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:40.301867Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:40.301870Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:40.301871Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:40.301873Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:40.301896Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:40.301903Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:40.301928Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:40.301944Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:40.301968Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:41.259031Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:41.259097Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:41.259110Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:41.259162Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:41.261333Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:41.261364Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:41.261378Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:41.261407Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.261432Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.262227Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:41.262234Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:41.262265Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:41.262304Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.262329Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.310734Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:41.310826Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813221306", "user_id": "kf001", "user_type": "kefu", "quality": "high_performance", "session": "ent_session_1752813221283_vasibxqdded", "connection_id": "ent_conn_1752813221283_2fh2du23e9w", "priority": "high", "timestamp": "2025-07-18T04:33:41.306Z", "user_name": "kf001"}
[2m2025-07-18T04:33:41.310857Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 137.334µs | 来源: Some(127.0.0.1:62576)
[2m2025-07-18T04:33:41.310891Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:41.310894Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:41.310901Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:41.310904Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:41.310905Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:41.312300Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:41.312331Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:41.312337Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:41.312341Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:41.312344Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:41.312347Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:41.312349Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:41.312400Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.312421Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.312421Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:41.313219Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:41.313388Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:41.313602Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:41.313805Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:41.314009Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.314031Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315005Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:41.315332Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.315338Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.315342Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:41.315345Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:41.315402Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:41.315441Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.315467Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.315470Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315479Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315481Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.315485Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.315487Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.315490Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.315492Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315500Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315502Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.315505Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.315507Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315515Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315517Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.315521Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.326703Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:41.326831Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "connection_id": "ent_conn_1752813221283_2fh2du23e9w", "session": "ent_session_1752813221283_vasibxqdded", "quality": "high_performance", "session_id": "session_1752813221307", "user_id": "kf001", "priority": "high", "timestamp": "2025-07-18T04:33:41.307Z", "user_type": "kefu"}
[2m2025-07-18T04:33:41.326851Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 162.533µs | 来源: Some(127.0.0.1:62578)
[2m2025-07-18T04:33:41.326936Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:41.326943Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:41.326959Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:41.326967Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:41.326971Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:41.328442Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:41.328472Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:41.328491Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:41.328494Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:41.328497Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:41.328500Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:41.328502Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:41.328549Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.328569Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.328569Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:41.329278Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:41.329430Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:41.329608Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:41.329784Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:41.329998Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.330017Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.330912Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:41.331309Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.331316Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.331319Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:41.331321Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:41.331364Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:41.331384Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.331403Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.331406Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331415Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331417Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.331421Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.331423Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.331426Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.331428Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331444Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331446Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.331450Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.331452Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331460Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331462Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.331466Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.505398Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:41.505459Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:41.505467Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:41.505509Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:41.507657Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:41.507670Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:41.507682Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:41.507704Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.507725Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.508428Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:41.508441Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:41.508476Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:41.508510Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.508538Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:41.558690Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:41.558786Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "timestamp": "2025-07-18T04:33:41.553Z", "quality": "high_performance", "user_id": "kf001", "session_id": "session_1752813221553", "user_name": "kf001", "connection_id": "ent_conn_1752813221531_b29eys65hau", "priority": "high", "session": "ent_session_1752813221531_sh16yu5a4x"}
[2m2025-07-18T04:33:41.558799Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 127.499µs | 来源: Some(127.0.0.1:62589)
[2m2025-07-18T04:33:41.558832Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:41.558836Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:41.558852Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:41.558856Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:41.558857Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:41.560074Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:41.560099Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:41.560105Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:41.560108Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:41.560112Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:41.560114Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:41.560116Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:41.560162Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.560181Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.560201Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:41.560771Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:41.560970Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:41.561210Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:41.561524Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.561548Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.561548Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:41.562587Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:41.562924Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.562934Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.562938Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:41.562941Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:41.562976Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:41.562990Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.563010Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.563013Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563022Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563037Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.563042Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.563044Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.563047Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.563049Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563058Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563060Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.563064Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.563065Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563073Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563075Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.563079Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.573447Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:41.573553Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "session": "ent_session_1752813221531_sh16yu5a4x", "user_name": "kf001", "priority": "high", "user_type": "kefu", "session_id": "session_1752813221554", "connection_id": "ent_conn_1752813221531_b29eys65hau", "timestamp": "2025-07-18T04:33:41.554Z", "quality": "high_performance"}
[2m2025-07-18T04:33:41.573567Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 158.377µs | 来源: Some(127.0.0.1:62592)
[2m2025-07-18T04:33:41.573606Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:41.573610Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:41.573616Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:41.573620Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:41.573622Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:41.574930Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:41.574945Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:41.574956Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:41.574962Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:41.574968Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:41.574973Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:41.574977Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:41.575076Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.575078Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:41.575162Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:41.575739Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:41.575953Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:41.576159Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:41.576334Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:41.576508Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.576526Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:41.577550Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:41.577919Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.577927Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:41.577931Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:41.577934Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:41.577988Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:41.578001Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.578022Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:41.578025Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578034Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578037Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.578040Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:41.578042Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.578046Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:41.578048Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578056Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578058Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.578062Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:41.578064Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578084Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578086Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:41.578090Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.586502Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:43.587309Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:43.587319Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813223584_dxdxo81y","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:43.584Z"}'
[2m2025-07-18T04:33:43.588227Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:43.588245Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:43.588327Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:43.588330Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:43.588334Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:43.588337Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:43.588340Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:43.588341Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:43.588366Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:43.588373Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:43.588390Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:43.588405Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:43.588409Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:43.588434Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:43.589248Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:43.589254Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813223584_vy3llb4g","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:43.584Z"}'
[2m2025-07-18T04:33:43.589609Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:43.589615Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:43.589687Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:43.589689Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:43.589693Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:43.589695Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:43.589697Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:43.589699Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:43.589720Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:43.589728Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:43.589745Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:43.589753Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:43.589777Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:43.666012Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:43.666058Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:43.666095Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:43.666138Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:43.668615Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:43.668643Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:43.668656Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:43.668686Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:43.668708Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:43.669513Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:43.669518Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:43.669545Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:43.669563Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:43.669577Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:43.721163Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:43.721266Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813223691_4b01xutuy45", "timestamp": "2025-07-18T04:33:43.714Z", "user_id": "kf001", "quality": "high_performance", "connection_id": "ent_conn_1752813223691_daodlmcw1j", "priority": "high", "user_name": "kf001", "session_id": "session_1752813223714", "user_type": "kefu"}
[2m2025-07-18T04:33:43.721290Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 144.826µs | 来源: Some(127.0.0.1:62681)
[2m2025-07-18T04:33:43.721323Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:43.721327Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:43.721331Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:43.721335Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:43.721337Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:43.722542Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:43.722553Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:43.722560Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:43.722563Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:43.722567Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:43.722569Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:43.722571Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:43.722617Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:43.722640Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:43.722645Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:43.723338Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:43.723538Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:43.723842Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:43.724011Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:43.724275Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:43.724299Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725339Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:43.725665Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:43.725673Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:43.725676Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:43.725679Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:43.725724Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:43.725745Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:43.725766Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:43.725768Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725778Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725780Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:43.725784Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:43.725786Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:43.725789Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:43.725791Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725799Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725801Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:43.725804Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:43.725806Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725814Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725816Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.725820Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.735063Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:43.735168Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813223715", "user_id": "kf001", "user_name": "kf001", "user_type": "kefu", "connection_id": "ent_conn_1752813223691_daodlmcw1j", "timestamp": "2025-07-18T04:33:43.715Z", "priority": "high", "session": "ent_session_1752813223691_4b01xutuy45", "quality": "high_performance"}
[2m2025-07-18T04:33:43.735181Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 135.681µs | 来源: Some(127.0.0.1:62686)
[2m2025-07-18T04:33:43.735217Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:43.735220Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:43.735227Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:43.735231Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:43.735233Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:43.736537Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:43.736553Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:43.736559Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:43.736577Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:43.736581Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:43.736583Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:43.736585Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:43.736630Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:43.736650Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:43.736649Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:43.737189Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:43.737338Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:43.737541Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:43.737658Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:43.738129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:43.738148Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:43.739391Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:43.739937Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:43.739943Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:43.739946Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:43.739948Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:43.739992Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:43.740001Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:43.740019Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:43.740022Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740033Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740035Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:43.740039Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:43.740041Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:43.740045Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:43.740047Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740067Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740069Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:43.740073Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:43.740075Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740086Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740088Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:43.740091Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.487625Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:44.487661Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:33:44.487684Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:44.487694Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:33:44.489901Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:44.489909Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:44.489921Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:44.489946Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:44.489969Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:44.490725Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:44.490730Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:33:44.490757Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:33:44.490794Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:44.490821Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserLeft
[2m2025-07-18T04:33:44.538666Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:44.538765Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752813224512_t6wkxx35tzl", "session_id": "session_1752813224534", "quality": "high_performance", "user_name": "kf001", "user_type": "kefu", "user_id": "kf001", "session": "ent_session_1752813224513_vxw0vw527dg", "priority": "high", "timestamp": "2025-07-18T04:33:44.534Z"}
[2m2025-07-18T04:33:44.538778Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 125.946µs | 来源: Some(127.0.0.1:62720)
[2m2025-07-18T04:33:44.538812Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:44.538816Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:44.538832Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:44.538835Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:44.538837Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:44.540276Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:44.540294Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:44.540300Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:44.540303Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:44.540306Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:44.540309Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:44.540311Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:44.540356Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:44.540375Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:44.540377Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:44.541023Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:44.541250Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:44.541566Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:44.541739Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:44.542027Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:44.542047Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543074Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:44.543431Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:44.543445Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:44.543448Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:44.543451Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:44.543478Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:44.543488Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:44.543505Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:44.543507Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543516Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543528Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:44.543531Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:44.543533Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:44.543537Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:44.543539Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543549Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543551Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:44.543554Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:44.543556Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543564Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543566Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.543570Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.552739Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:44.552830Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752813224512_t6wkxx35tzl", "priority": "high", "session_id": "session_1752813224535", "user_id": "kf001", "timestamp": "2025-07-18T04:33:44.535Z", "user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "session": "ent_session_1752813224513_vxw0vw527dg"}
[2m2025-07-18T04:33:44.552847Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 125.847µs | 来源: Some(127.0.0.1:62722)
[2m2025-07-18T04:33:44.552878Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:33:44.552881Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:33:44.552884Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:33:44.552888Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:33:44.552890Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:33:44.554102Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:33:44.554117Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:33:44.554124Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:33:44.554128Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:33:44.554131Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:44.554133Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:33:44.554136Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:33:44.554197Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:44.554216Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=UserJoined
[2m2025-07-18T04:33:44.554221Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:33:44.554961Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:33:44.555182Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:33:44.555440Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:44.555659Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:44.555686Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=OnlineUsers
[2m2025-07-18T04:33:44.555703Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:33:44.556775Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:44.557120Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:44.557127Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:33:44.557130Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:33:44.557133Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:33:44.557185Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:33:44.557197Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:44.557216Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:33:44.557219Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557228Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557230Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:44.557234Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:33:44.557235Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:44.557239Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:44.557241Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557248Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557251Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:44.557254Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:44.557256Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557274Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557276Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:44.557280Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:46.554796Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:46.555328Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:46.555337Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813226552_jqb6lup2","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:46.552Z"}'
[2m2025-07-18T04:33:46.555871Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:46.555887Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:46.556000Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:46.556003Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:46.556007Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:46.556010Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:46.556012Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:46.556014Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:46.556038Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:46.556045Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:46.556062Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:46.556077Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:46.556081Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:46.556107Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:46.556638Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:46.556644Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813226552_vj2zw8go","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:46.552Z"}'
[2m2025-07-18T04:33:46.556902Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:46.556908Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:46.556961Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:46.556964Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:46.556967Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:46.556969Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:46.556971Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:46.556972Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:46.556994Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:46.557002Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:46.557018Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:46.557032Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:46.557055Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:48.564436Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:48.565340Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:48.565352Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813228562_5sg7cnp7","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:48.562Z"}'
[2m2025-07-18T04:33:48.565990Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:48.566000Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:48.566075Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:48.566078Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:48.566081Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:48.566084Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:48.566087Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:48.566089Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:48.566112Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:48.566120Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:48.566145Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:48.566153Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:48.566160Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:48.566207Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:48.566554Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:48.566569Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813228562_s10oq11v","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:48.562Z"}'
[2m2025-07-18T04:33:48.566980Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:48.566987Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:48.567089Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:48.567092Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:48.567095Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:48.567099Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:48.567101Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:48.567103Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:48.567129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:48.567139Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:48.567161Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:48.567169Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:48.567194Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:48.964103Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/2, 利用率: 0.0%
[2m2025-07-18T04:33:49.606155Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813016762: 长度=59
[2m2025-07-18T04:33:49.606860Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:33:49.603Z }
[2m2025-07-18T04:33:49.606878Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752813016762, 使用连接ID
[2m2025-07-18T04:33:49.607453Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752813016762
[2m2025-07-18T04:33:49.607471Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Heartbeat消息给: customer_1752813016762
[2m2025-07-18T04:33:49.607475Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Heartbeat消息给: customer_1752813016762
[2m2025-07-18T04:33:49.607484Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Heartbeat
[2m2025-07-18T04:33:49.607515Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Heartbeat
[2m2025-07-18T04:33:50.598585Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:50.599239Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:50.599246Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813230595_nj66zqh5","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:50.595Z"}'
[2m2025-07-18T04:33:50.599781Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:50.599794Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:50.599836Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:50.599839Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:50.599842Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:50.599845Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:50.599848Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:50.599850Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:50.599873Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:50.599879Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:50.599896Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:50.599910Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:50.599916Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:50.599940Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:50.600339Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:50.600345Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813230596_8hws8asg","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:50.596Z"}'
[2m2025-07-18T04:33:50.600818Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:50.600825Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:50.600884Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:50.600887Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:50.601051Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:50.601057Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:50.601060Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:50.601062Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:50.601083Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:50.601091Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:50.601107Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:50.601118Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:50.601142Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:52.601771Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:52.602336Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:52.602347Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813232599_zykzlv26","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:52.599Z"}'
[2m2025-07-18T04:33:52.602792Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:52.602800Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:52.602891Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:52.602894Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:52.602898Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:52.602901Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:52.602903Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:52.602905Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:52.602929Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:52.602936Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:52.602954Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:52.602968Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:52.602972Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:52.602996Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:52.603311Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:52.603328Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813232599_qdmuegol","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:52.599Z"}'
[2m2025-07-18T04:33:52.603793Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:52.603807Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:52.603883Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:52.603885Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:52.603888Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:52.603890Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:52.603893Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:52.603895Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:52.603917Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:52.603924Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:52.603941Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:52.603956Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:52.603979Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:53.607095Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813016762: 长度=59
[2m2025-07-18T04:33:53.607727Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:33:53.604Z }
[2m2025-07-18T04:33:53.607749Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752813016762, 使用连接ID
[2m2025-07-18T04:33:53.608235Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752813016762
[2m2025-07-18T04:33:53.608243Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Heartbeat消息给: customer_1752813016762
[2m2025-07-18T04:33:53.608247Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Heartbeat消息给: customer_1752813016762
[2m2025-07-18T04:33:53.608254Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Heartbeat
[2m2025-07-18T04:33:53.608275Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Heartbeat
[2m2025-07-18T04:33:54.601459Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:54.602330Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:54.602373Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813234598_0f3q4rsf","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:54.598Z"}'
[2m2025-07-18T04:33:54.602856Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:54.602873Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:54.602947Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:54.602949Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:54.602953Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:54.602956Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:54.602959Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:54.602961Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:54.602990Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:54.603000Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:54.603020Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:54.603037Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:54.603036Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:54.603064Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:54.603392Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:54.603409Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813234598_dyf466vj","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:54.598Z"}'
[2m2025-07-18T04:33:54.603775Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:54.603782Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:54.603860Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:54.603863Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:54.603866Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:54.603869Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:54.603871Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:54.603873Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:54.604058Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:54.604068Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:54.604085Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:54.604094Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:54.604119Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:54.957442Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813016762: 长度=59
[2m2025-07-18T04:33:54.958262Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:33:54.954Z }
[2m2025-07-18T04:33:54.958284Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752813016762, 使用连接ID
[2m2025-07-18T04:33:54.958814Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752813016762
[2m2025-07-18T04:33:54.958827Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Heartbeat消息给: customer_1752813016762
[2m2025-07-18T04:33:54.958830Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Heartbeat消息给: customer_1752813016762
[2m2025-07-18T04:33:54.958839Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Heartbeat
[2m2025-07-18T04:33:54.958864Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Heartbeat
[2m2025-07-18T04:33:56.607681Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:56.608466Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:56.608477Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813236604_02a67nu7","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:56.604Z"}'
[2m2025-07-18T04:33:56.608860Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:56.608868Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:56.608969Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:56.608973Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:56.608977Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:56.608979Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:56.608982Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:56.608984Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:56.609013Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:56.609032Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:56.609051Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:56.609065Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:56.609067Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:56.609096Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:56.609597Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:56.609618Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813236604_tj9w5o42","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:56.604Z"}'
[2m2025-07-18T04:33:56.610033Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813016762
[2m2025-07-18T04:33:56.610040Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813016762
[2m2025-07-18T04:33:56.610094Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:56.610096Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813016762
[2m2025-07-18T04:33:56.610099Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:56.610102Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813016762
[2m2025-07-18T04:33:56.610104Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:56.610106Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:56.610129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:56.610137Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:56.610154Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:56.610168Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:56.610191Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813016762: 类型=Chat
[2m2025-07-18T04:33:57.268095Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813016762: 长度=0
[2m2025-07-18T04:33:57.268141Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: customer_1752813016762
[2m2025-07-18T04:33:57.268186Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813016762: 长度=0
[2m2025-07-18T04:33:57.268196Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: customer_1752813016762
[2m2025-07-18T04:33:57.268279Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813016762: 长度=0
[2m2025-07-18T04:33:57.268294Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: customer_1752813016762
[2m2025-07-18T04:33:57.269337Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:57.269364Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:57.270407Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:57.270415Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User customer_1752813016762 disconnected after connection cleanup
[2m2025-07-18T04:33:57.270425Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: customer_1752813016762
[2m2025-07-18T04:33:57.270445Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserLeft
[2m2025-07-18T04:33:57.270461Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserLeft
[2m2025-07-18T04:33:57.270463Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.270473Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.271431Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:57.271460Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User customer_1752813016762 disconnected after connection cleanup
[2m2025-07-18T04:33:57.271474Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: customer_1752813016762
[2m2025-07-18T04:33:57.271512Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserLeft
[2m2025-07-18T04:33:57.271539Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserLeft
[2m2025-07-18T04:33:57.271542Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.271550Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.272399Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:33:57.272418Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User customer_1752813016762 disconnected after connection cleanup
[2m2025-07-18T04:33:57.272450Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: customer_1752813016762
[2m2025-07-18T04:33:57.272472Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserLeft
[2m2025-07-18T04:33:57.272490Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserLeft
[2m2025-07-18T04:33:57.272493Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.272502Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.335012Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:57.335115Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813237329", "user_type": "kehu", "user_id": "customer_1752813237319"}
[2m2025-07-18T04:33:57.335130Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 140.81µs | 来源: Some(127.0.0.1:63200)
[2m2025-07-18T04:33:57.335171Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813237319, 用户名=customer_1752813237319, 类型=Kehu
[2m2025-07-18T04:33:57.335175Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813237319, user_name=customer_1752813237319, user_type=Kehu
[2m2025-07-18T04:33:57.335189Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813237319
[2m2025-07-18T04:33:57.335193Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752813237319
[2m2025-07-18T04:33:57.335194Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752813237319
[2m2025-07-18T04:33:57.336436Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752813237319
[2m2025-07-18T04:33:57.336448Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752813237319
[2m2025-07-18T04:33:57.336455Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752813237319
[2m2025-07-18T04:33:57.336458Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752813237319
[2m2025-07-18T04:33:57.336462Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:57.336464Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752813237319
[2m2025-07-18T04:33:57.336475Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752813237319
[2m2025-07-18T04:33:57.336519Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:57.336538Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:57.336541Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752813237319启动Redis频道订阅: ["user:customer_1752813237319:messages", "user:customer_1752813237319:notifications", "system:broadcasts", "session:customer_1752813237319:events"]
[2m2025-07-18T04:33:57.337313Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: user:customer_1752813237319:messages
[2m2025-07-18T04:33:57.337578Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: user:customer_1752813237319:notifications
[2m2025-07-18T04:33:57.337755Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:57.337960Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: session:customer_1752813237319:events
[2m2025-07-18T04:33:57.338194Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.338220Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.338223Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:57.338227Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:57.339044Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:57.339051Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752813237319请求分配客服
[2m2025-07-18T04:33:57.339054Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752813237319 <-> kf001
[2m2025-07-18T04:33:57.339070Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.339083Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.340427Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m ✅ 客户customer_1752813237319已从等待队列移除
[2m2025-07-18T04:33:57.340649Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🎯 企业级会话已建立: customer_1752813237319 <-> kf001
[2m2025-07-18T04:33:57.340660Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎯 企业级会话已建立: customer_1752813237319 <-> kf001 (增强模式)
[2m2025-07-18T04:33:57.340663Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 会话建立成功: customer_1752813237319 <-> kf001
[2m2025-07-18T04:33:57.340667Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:57.340670Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752813237319
[2m2025-07-18T04:33:57.340712Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752813237319
[2m2025-07-18T04:33:57.340722Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Welcome
[2m2025-07-18T04:33:57.340737Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.340740Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Welcome
[2m2025-07-18T04:33:57.340757Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.340764Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.340766Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.340769Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=History
[2m2025-07-18T04:33:57.340772Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=History
[2m2025-07-18T04:33:57.340774Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:33:57.340778Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:33:57.340780Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.340792Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.349881Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:33:57.349976Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813237330", "user_id": "customer_1752813237319", "user_type": "kehu"}
[2m2025-07-18T04:33:57.349995Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 132.076µs | 来源: Some(127.0.0.1:63202)
[2m2025-07-18T04:33:57.350030Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813237319, 用户名=customer_1752813237319, 类型=Kehu
[2m2025-07-18T04:33:57.350034Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813237319, user_name=customer_1752813237319, user_type=Kehu
[2m2025-07-18T04:33:57.350042Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813237319
[2m2025-07-18T04:33:57.350055Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752813237319
[2m2025-07-18T04:33:57.350057Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752813237319
[2m2025-07-18T04:33:57.351380Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752813237319
[2m2025-07-18T04:33:57.351396Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752813237319
[2m2025-07-18T04:33:57.351410Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752813237319
[2m2025-07-18T04:33:57.351413Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752813237319
[2m2025-07-18T04:33:57.351417Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:57.351420Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752813237319
[2m2025-07-18T04:33:57.351438Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752813237319
[2m2025-07-18T04:33:57.351484Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:57.351503Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:33:57.351507Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752813237319启动Redis频道订阅: ["user:customer_1752813237319:messages", "user:customer_1752813237319:notifications", "system:broadcasts", "session:customer_1752813237319:events"]
[2m2025-07-18T04:33:57.352104Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: user:customer_1752813237319:messages
[2m2025-07-18T04:33:57.352382Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: user:customer_1752813237319:notifications
[2m2025-07-18T04:33:57.352553Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:33:57.352772Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: session:customer_1752813237319:events
[2m2025-07-18T04:33:57.353007Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.353026Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.353029Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:57.353033Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:33:57.354157Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:33:57.354164Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752813237319请求分配客服
[2m2025-07-18T04:33:57.354167Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752813237319 <-> kf001
[2m2025-07-18T04:33:57.354185Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.354203Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.355740Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m ✅ 客户customer_1752813237319已从等待队列移除
[2m2025-07-18T04:33:57.355931Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🎯 企业级会话已建立: customer_1752813237319 <-> kf001
[2m2025-07-18T04:33:57.355948Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎯 企业级会话已建立: customer_1752813237319 <-> kf001 (增强模式)
[2m2025-07-18T04:33:57.355952Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 会话建立成功: customer_1752813237319 <-> kf001
[2m2025-07-18T04:33:57.355956Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:33:57.355959Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752813237319
[2m2025-07-18T04:33:57.355993Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752813237319
[2m2025-07-18T04:33:57.356006Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Welcome
[2m2025-07-18T04:33:57.356012Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.356024Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Welcome
[2m2025-07-18T04:33:57.356026Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.356033Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:33:57.356034Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.356037Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=History
[2m2025-07-18T04:33:57.356041Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=History
[2m2025-07-18T04:33:57.356043Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:33:57.356047Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:33:57.356049Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:57.356058Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:33:58.346645Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813237319: 长度=159
[2m2025-07-18T04:33:58.347413Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `text`, expected one of `Text`, `Image`, `File`, `Voice`, `Video`, `Html`, 当作文本消息处理
[2m2025-07-18T04:33:58.347442Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: customer_1752813237319 -> '{"type":"Chat","from":"customer_1752813237319","to":"system","content":"客户请求客服服务","content_type":"text","timestamp":"2025-07-18T04:33:58.343Z"}'
[2m2025-07-18T04:33:58.347936Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客户customer_1752813237319继续与专属客服对话: kf001
[2m2025-07-18T04:33:58.347942Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: customer_1752813237319 -> kf001
[2m2025-07-18T04:33:58.348008Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:58.348011Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: kf001
[2m2025-07-18T04:33:58.348015Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:58.348030Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:58.348033Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: customer_1752813237319
[2m2025-07-18T04:33:58.348035Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.348063Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.348073Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.348094Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.348118Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.348163Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.361544Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813237319: 长度=159
[2m2025-07-18T04:33:58.362524Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `text`, expected one of `Text`, `Image`, `File`, `Voice`, `Video`, `Html`, 当作文本消息处理
[2m2025-07-18T04:33:58.362531Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: customer_1752813237319 -> '{"type":"Chat","from":"customer_1752813237319","to":"system","content":"客户请求客服服务","content_type":"text","timestamp":"2025-07-18T04:33:58.358Z"}'
[2m2025-07-18T04:33:58.362999Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客户customer_1752813237319继续与专属客服对话: kf001
[2m2025-07-18T04:33:58.363017Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: customer_1752813237319 -> kf001
[2m2025-07-18T04:33:58.363063Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:58.363066Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: kf001
[2m2025-07-18T04:33:58.363070Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:58.363073Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:58.363075Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: customer_1752813237319
[2m2025-07-18T04:33:58.363077Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.363102Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.363112Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.363134Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.363148Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.363176Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.607753Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:58.608535Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:58.608558Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813238604_1qi9jiwc","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:58.604Z"}'
[2m2025-07-18T04:33:58.609110Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:33:58.609129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:33:58.609182Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:58.609185Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:33:58.609188Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.609191Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.609194Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:58.609196Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:58.609226Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:58.609235Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:33:58.609256Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.609274Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.609278Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.609307Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.609647Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:33:58.609654Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813238604_w9zl5par","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:33:58.604Z"}'
[2m2025-07-18T04:33:58.610028Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:33:58.610035Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:33:58.610086Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:33:58.610088Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:33:58.610091Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.610093Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:33:58.610100Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:33:58.610105Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:33:58.610272Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:33:58.610293Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.610310Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:33:58.610417Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:33:58.610444Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:00.610331Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:00.611210Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:00.611220Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813240607_nbhld3lu","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:00.607Z"}'
[2m2025-07-18T04:34:00.611587Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:34:00.611603Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:34:00.611656Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:34:00.611658Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:34:00.611662Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:00.611665Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:00.611667Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:34:00.611669Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:34:00.611692Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:34:00.611700Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:00.611716Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:00.611731Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:00.611735Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:00.611761Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:00.612314Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:00.612321Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813240607_9839tt9a","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:00.607Z"}'
[2m2025-07-18T04:34:00.612659Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:34:00.612664Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:34:00.612718Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:34:00.612721Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:34:00.612723Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:00.612725Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:00.612727Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:34:00.612729Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:34:00.612751Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:34:00.612758Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:00.612773Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:00.612789Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:00.612812Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:02.624788Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:02.930927Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:02.930956Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813242606_m3veueel","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:02.606Z"}'
[2m2025-07-18T04:34:03.236317Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:34:03.236348Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:34:03.236409Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:34:03.236413Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:34:03.236418Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:03.236422Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:03.236426Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:34:03.236429Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:34:03.236459Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:34:03.236470Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:03.236508Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:03.236523Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:03.236526Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:03.236554Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:03.237273Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:03.237279Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813242606_ds975131","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:02.606Z"}'
[2m2025-07-18T04:34:03.237686Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:34:03.237692Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:34:03.237727Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:34:03.237729Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:34:03.237732Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:03.237734Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:03.237736Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:34:03.237738Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:34:03.237759Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:34:03.237766Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:03.237782Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:03.237802Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:03.237825Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:04.555668Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:04.556383Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:04.556392Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813244552_ff7d2mal","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:04.552Z"}'
[2m2025-07-18T04:34:04.556804Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:34:04.556811Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:34:04.556866Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:34:04.556869Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:34:04.556873Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:04.556876Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:04.556878Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:34:04.556880Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:34:04.556903Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:34:04.556921Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:04.556938Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:04.556942Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:04.556951Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:04.556968Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:04.557476Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:04.557501Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813244553_f71hwjoe","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:04.553Z"}'
[2m2025-07-18T04:34:04.557939Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👨‍💼 客服kf001继续与客户对话: customer_1752813237319
[2m2025-07-18T04:34:04.557947Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💬 找到聊天伙伴: kf001 -> customer_1752813237319
[2m2025-07-18T04:34:04.557978Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 💾 消息已保存到本地存储
[2m2025-07-18T04:34:04.557980Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 转发消息给接收者: customer_1752813237319
[2m2025-07-18T04:34:04.557983Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:04.557985Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: customer_1752813237319
[2m2025-07-18T04:34:04.557987Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 回显消息给发送者: kf001
[2m2025-07-18T04:34:04.557989Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送Chat消息给: kf001
[2m2025-07-18T04:34:04.558010Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送Chat消息给: kf001
[2m2025-07-18T04:34:04.558018Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:04.558035Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Chat
[2m2025-07-18T04:34:04.558047Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:04.558069Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Chat
[2m2025-07-18T04:34:05.616788Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:34:05.616854Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:34:05.619098Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:34:05.619106Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:34:05.619136Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:34:05.619185Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserLeft
[2m2025-07-18T04:34:05.619211Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserLeft
[2m2025-07-18T04:34:05.667592Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:05.667698Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813245660", "quality": "high_performance", "user_type": "kefu", "priority": "high", "session": "ent_session_1752813245639_nh0j0y2qf5f", "user_id": "kf001", "connection_id": "ent_conn_1752813245639_mdmqx3hjfq", "user_name": "kf001", "timestamp": "2025-07-18T04:34:05.660Z"}
[2m2025-07-18T04:34:05.667716Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 145.037µs | 来源: Some(127.0.0.1:63516)
[2m2025-07-18T04:34:05.667752Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:05.667756Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:05.667764Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:05.667768Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:34:05.667770Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:34:05.669121Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:34:05.669139Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:34:05.669147Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:34:05.669150Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:34:05.669153Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:34:05.669156Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:34:05.669158Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:34:05.669210Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:05.669232Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:05.669231Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:34:05.669982Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:34:05.670125Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:34:05.670353Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:05.670542Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:34:05.670744Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:05.670771Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:05.671724Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:34:05.672035Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:34:05.672042Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:34:05.672045Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:34:05.672048Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:34:05.672096Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:34:05.672108Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:34:05.672126Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:34:05.672129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672138Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672140Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:34:05.672144Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:34:05.672146Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:05.672150Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:05.672152Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672159Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672161Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:05.672168Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:05.672182Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672186Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672188Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.672192Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.680201Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:05.680300Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813245639_nh0j0y2qf5f", "connection_id": "ent_conn_1752813245639_mdmqx3hjfq", "user_name": "kf001", "quality": "high_performance", "user_id": "kf001", "user_type": "kefu", "session_id": "session_1752813245661", "priority": "high", "timestamp": "2025-07-18T04:34:05.661Z"}
[2m2025-07-18T04:34:05.680327Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 143.514µs | 来源: Some(127.0.0.1:63518)
[2m2025-07-18T04:34:05.680364Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:05.680367Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:05.680374Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:05.680379Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:34:05.680381Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:34:05.681452Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:34:05.681460Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:34:05.681471Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:34:05.681475Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:34:05.681478Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:34:05.681480Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:34:05.681482Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:34:05.681526Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:05.681541Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:05.681558Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:34:05.682070Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:34:05.682304Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:34:05.682515Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:05.682704Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:34:05.682954Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:05.682975Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:05.683853Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 2 个用户在线
[2m2025-07-18T04:34:05.684252Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:34:05.684259Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:34:05.684262Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共1个客户
[2m2025-07-18T04:34:05.684273Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:34:05.684314Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:34:05.684324Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:34:05.684341Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:34:05.684343Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684352Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684354Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:34:05.684358Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:34:05.684360Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:05.684364Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:05.684366Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684372Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684375Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:05.684378Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:05.684380Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684389Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684391Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.684395Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:05.924276Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:34:05.924366Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:34:05.926549Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:34:05.926566Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m User kf001 disconnected after connection cleanup
[2m2025-07-18T04:34:05.926602Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 发送任务结束: kf001
[2m2025-07-18T04:34:05.926640Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserLeft
[2m2025-07-18T04:34:05.926670Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserLeft
[2m2025-07-18T04:34:07.365577Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:07.365681Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752813237319", "session_id": "session_1752813247359", "user_type": "kehu"}
[2m2025-07-18T04:34:07.365694Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 135.371µs | 来源: Some(127.0.0.1:63592)
[2m2025-07-18T04:34:07.365738Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813237319, 用户名=customer_1752813237319, 类型=Kehu
[2m2025-07-18T04:34:07.365742Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813237319, user_name=customer_1752813237319, user_type=Kehu
[2m2025-07-18T04:34:07.365750Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813237319
[2m2025-07-18T04:34:07.365755Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752813237319
[2m2025-07-18T04:34:07.365757Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752813237319
[2m2025-07-18T04:34:07.367233Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752813237319
[2m2025-07-18T04:34:07.367241Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752813237319
[2m2025-07-18T04:34:07.367247Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752813237319
[2m2025-07-18T04:34:07.367250Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752813237319
[2m2025-07-18T04:34:07.367254Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共1个客户
[2m2025-07-18T04:34:07.367256Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752813237319
[2m2025-07-18T04:34:07.367268Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752813237319
[2m2025-07-18T04:34:07.367289Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752813237319启动Redis频道订阅: ["user:customer_1752813237319:messages", "user:customer_1752813237319:notifications", "system:broadcasts", "session:customer_1752813237319:events"]
[2m2025-07-18T04:34:07.367890Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: user:customer_1752813237319:messages
[2m2025-07-18T04:34:07.368071Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: user:customer_1752813237319:notifications
[2m2025-07-18T04:34:07.368258Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:07.368663Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752813237319已订阅Redis频道: session:customer_1752813237319:events
[2m2025-07-18T04:34:07.370137Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 1 个用户在线
[2m2025-07-18T04:34:07.370145Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752813237319请求分配客服
[2m2025-07-18T04:34:07.370148Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 没有可用客服，客户 customer_1752813237319 暂时无法分配
[2m2025-07-18T04:34:07.370150Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752813237319
[2m2025-07-18T04:34:07.370188Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752813237319
[2m2025-07-18T04:34:07.370201Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=Welcome
[2m2025-07-18T04:34:07.370223Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=Welcome
[2m2025-07-18T04:34:07.370225Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:07.370247Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:07.370249Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=History
[2m2025-07-18T04:34:07.370253Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=History
[2m2025-07-18T04:34:07.370255Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:07.370259Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:07.370261Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:07.370266Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:07.686191Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:07.687064Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:07.687085Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813247682_3yssyq7z","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:07.682Z"}'
[2m2025-07-18T04:34:07.687090Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 用户连接信息未找到: kf001
[2m2025-07-18T04:34:07.687096Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:07.687674Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:07.687694Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813247682_asgh7mzk","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:07.682Z"}'
[2m2025-07-18T04:34:07.687697Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 用户连接信息未找到: kf001
[2m2025-07-18T04:34:08.378801Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813237319: 长度=159
[2m2025-07-18T04:34:08.379689Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `text`, expected one of `Text`, `Image`, `File`, `Voice`, `Video`, `Html`, 当作文本消息处理
[2m2025-07-18T04:34:08.379708Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: customer_1752813237319 -> '{"type":"Chat","from":"customer_1752813237319","to":"system","content":"客户请求客服服务","content_type":"text","timestamp":"2025-07-18T04:34:08.374Z"}'
[2m2025-07-18T04:34:08.380177Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 专属客服kf001已离线，重新分配
[2m2025-07-18T04:34:08.381489Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🧹 已清除会话关系: customer_1752813237319 <-> kf001
[2m2025-07-18T04:34:08.381502Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ⏳ 客户customer_1752813237319进入等待队列
[2m2025-07-18T04:34:08.381969Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 📋 客户customer_1752813237319已加入等待队列
[2m2025-07-18T04:34:08.381977Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 没有找到聊天伙伴: customer_1752813237319
[2m2025-07-18T04:34:09.688864Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:09.689729Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:09.689747Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813249685_p00zdde6","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:09.685Z"}'
[2m2025-07-18T04:34:09.689751Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 用户连接信息未找到: kf001
[2m2025-07-18T04:34:09.689759Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:09.690187Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:09.690196Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813249685_agjrcsd8","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:09.685Z"}'
[2m2025-07-18T04:34:09.690199Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ 用户连接信息未找到: kf001
[2m2025-07-18T04:34:11.084925Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.085023Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752812585805", "session_id": "session_1752812585830"}
[2m2025-07-18T04:34:11.085035Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 128.931µs | 来源: Some(127.0.0.1:63738)
[2m2025-07-18T04:34:11.085076Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752812585805, 用户名=customer_1752812585805, 类型=Kehu
[2m2025-07-18T04:34:11.085080Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752812585805, user_name=customer_1752812585805, user_type=Kehu
[2m2025-07-18T04:34:11.085090Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752812585805
[2m2025-07-18T04:34:11.085094Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752812585805
[2m2025-07-18T04:34:11.085118Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752812585805
[2m2025-07-18T04:34:11.086205Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.086303Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "priority": "high", "session_id": "session_1752813191398", "timestamp": "2025-07-18T04:33:11.398Z", "user_name": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_id": "kf001"}
[2m2025-07-18T04:34:11.086333Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 159.188µs | 来源: Some(127.0.0.1:63739)
[2m2025-07-18T04:34:11.086369Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.086373Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.086380Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.086383Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:34:11.086385Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:34:11.086399Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.086563Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752812585805
[2m2025-07-18T04:34:11.086573Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752812585805
[2m2025-07-18T04:34:11.086581Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752809267952", "session_id": "session_1752809267974", "user_type": "kehu"}
[2m2025-07-18T04:34:11.086596Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 253.795µs | 来源: Some(127.0.0.1:63740)
[2m2025-07-18T04:34:11.086601Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752812585805
[2m2025-07-18T04:34:11.086607Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752812585805
[2m2025-07-18T04:34:11.086612Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共2个客户
[2m2025-07-18T04:34:11.086614Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752812585805
[2m2025-07-18T04:34:11.086626Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752812585805
[2m2025-07-18T04:34:11.086634Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.086636Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752809267952, 用户名=customer_1752809267952, 类型=Kehu
[2m2025-07-18T04:34:11.086641Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752809267952, user_name=customer_1752809267952, user_type=Kehu
[2m2025-07-18T04:34:11.086647Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752809267952
[2m2025-07-18T04:34:11.086653Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752809267952
[2m2025-07-18T04:34:11.086655Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752809267952
[2m2025-07-18T04:34:11.086656Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.086661Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752812585805启动Redis频道订阅: ["user:customer_1752812585805:messages", "user:customer_1752812585805:notifications", "system:broadcasts", "session:customer_1752812585805:events"]
[2m2025-07-18T04:34:11.087076Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.087113Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752809267955", "user_type": "kehu", "user_id": "customer_1752809267937"}
[2m2025-07-18T04:34:11.087124Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 59.573µs | 来源: Some(127.0.0.1:63741)
[2m2025-07-18T04:34:11.087174Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752809267937, 用户名=customer_1752809267937, 类型=Kehu
[2m2025-07-18T04:34:11.087177Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752809267937, user_name=customer_1752809267937, user_type=Kehu
[2m2025-07-18T04:34:11.087183Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752809267937
[2m2025-07-18T04:34:11.087185Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752809267937
[2m2025-07-18T04:34:11.087187Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752809267937
[2m2025-07-18T04:34:11.087294Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: user:customer_1752812585805:messages
[2m2025-07-18T04:34:11.087579Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: user:customer_1752812585805:notifications
[2m2025-07-18T04:34:11.087723Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.087852Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:34:11.087857Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:34:11.087885Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:34:11.087891Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:34:11.087894Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.087897Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:34:11.087899Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:34:11.087906Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.087924Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.087927Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:34:11.087958Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: session:customer_1752812585805:events
[2m2025-07-18T04:34:11.088370Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:34:11.088540Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:34:11.088739Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.089016Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:34:11.089448Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.089488Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.090510Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752809267952
[2m2025-07-18T04:34:11.090521Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752809267952
[2m2025-07-18T04:34:11.090552Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752809267952
[2m2025-07-18T04:34:11.090557Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752809267952
[2m2025-07-18T04:34:11.090562Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.090565Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752809267952
[2m2025-07-18T04:34:11.090576Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752809267952
[2m2025-07-18T04:34:11.090583Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.090604Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.090621Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752809267952启动Redis频道订阅: ["user:customer_1752809267952:messages", "user:customer_1752809267952:notifications", "system:broadcasts", "session:customer_1752809267952:events"]
[2m2025-07-18T04:34:11.091191Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: user:customer_1752809267952:messages
[2m2025-07-18T04:34:11.091411Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: user:customer_1752809267952:notifications
[2m2025-07-18T04:34:11.091584Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.091813Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752809267937
[2m2025-07-18T04:34:11.091820Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752809267937
[2m2025-07-18T04:34:11.091825Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752809267937
[2m2025-07-18T04:34:11.091828Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752809267937
[2m2025-07-18T04:34:11.091831Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.091834Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752809267937
[2m2025-07-18T04:34:11.091844Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752809267937
[2m2025-07-18T04:34:11.091847Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: session:customer_1752809267952:events
[2m2025-07-18T04:34:11.091864Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.091876Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.091926Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752809267937启动Redis频道订阅: ["user:customer_1752809267937:messages", "user:customer_1752809267937:notifications", "system:broadcasts", "session:customer_1752809267937:events"]
[2m2025-07-18T04:34:11.092578Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: user:customer_1752809267937:messages
[2m2025-07-18T04:34:11.092692Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: user:customer_1752809267937:notifications
[2m2025-07-18T04:34:11.093085Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.093311Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: session:customer_1752809267937:events
[2m2025-07-18T04:34:11.093356Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.093363Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752812585805请求分配客服
[2m2025-07-18T04:34:11.093366Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752812585805 <-> kf001
[2m2025-07-18T04:34:11.093551Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.093573Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.093717Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.093742Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.093745Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.093759Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.095376Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m ✅ 客户customer_1752812585805已从等待队列移除
[2m2025-07-18T04:34:11.095401Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.095443Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752812585805", "session_id": "session_1752812596065"}
[2m2025-07-18T04:34:11.095455Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 64.731µs | 来源: Some(127.0.0.1:63746)
[2m2025-07-18T04:34:11.095487Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752812585805, 用户名=customer_1752812585805, 类型=Kehu
[2m2025-07-18T04:34:11.095489Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752812585805, user_name=customer_1752812585805, user_type=Kehu
[2m2025-07-18T04:34:11.095510Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752812585805
[2m2025-07-18T04:34:11.095600Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🎯 企业级会话已建立: customer_1752812585805 <-> kf001
[2m2025-07-18T04:34:11.095614Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎯 企业级会话已建立: customer_1752812585805 <-> kf001 (增强模式)
[2m2025-07-18T04:34:11.095659Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 会话建立成功: customer_1752812585805 <-> kf001
[2m2025-07-18T04:34:11.096641Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.096723Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "priority": "high", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_name": "kf001", "session_id": "session_1752813191398", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "timestamp": "2025-07-18T04:33:11.398Z", "user_id": "kf001"}
[2m2025-07-18T04:34:11.096746Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 126.917µs | 来源: Some(127.0.0.1:63747)
[2m2025-07-18T04:34:11.096781Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.096809Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752809267972", "user_id": "customer_1752809267952", "user_type": "kehu"}
[2m2025-07-18T04:34:11.096824Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 72.964µs | 来源: Some(127.0.0.1:63748)
[2m2025-07-18T04:34:11.096835Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.096841Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.096849Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752809267952, 用户名=customer_1752809267952, 类型=Kehu
[2m2025-07-18T04:34:11.096850Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.096852Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752809267952, user_name=customer_1752809267952, user_type=Kehu
[2m2025-07-18T04:34:11.096858Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752809267952
[2m2025-07-18T04:34:11.097105Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752812585805
[2m2025-07-18T04:34:11.097111Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752812585805
[2m2025-07-18T04:34:11.097129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.097132Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752812585805
[2m2025-07-18T04:34:11.097159Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752812585805
[2m2025-07-18T04:34:11.097169Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=Welcome
[2m2025-07-18T04:34:11.097185Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=Welcome
[2m2025-07-18T04:34:11.097188Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097186Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:34:11.097194Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:34:11.097197Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752809267952
[2m2025-07-18T04:34:11.097197Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097199Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752809267952
[2m2025-07-18T04:34:11.097201Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=History
[2m2025-07-18T04:34:11.097210Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.097213Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=History
[2m2025-07-18T04:34:11.097215Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.097215Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097217Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752809267952请求分配客服
[2m2025-07-18T04:34:11.097219Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752809267952 <-> kf001
[2m2025-07-18T04:34:11.097220Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097223Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097232Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097234Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097239Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.097241Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097284Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752809267937请求分配客服
[2m2025-07-18T04:34:11.097287Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097289Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752809267937 <-> kf001
[2m2025-07-18T04:34:11.097298Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097300Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097308Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=UserJoined
[2m2025-07-18T04:34:11.097310Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097318Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097320Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097326Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097328Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097342Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752812585805: 类型=OnlineUsers
[2m2025-07-18T04:34:11.097651Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.097691Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752809267937", "session_id": "session_1752809267956", "user_type": "kehu"}
[2m2025-07-18T04:34:11.097713Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 74.566µs | 来源: Some(127.0.0.1:63749)
[2m2025-07-18T04:34:11.097737Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752809267937, 用户名=customer_1752809267937, 类型=Kehu
[2m2025-07-18T04:34:11.097739Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752809267937, user_name=customer_1752809267937, user_type=Kehu
[2m2025-07-18T04:34:11.097744Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752809267937
[2m2025-07-18T04:34:11.098302Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752812585805
[2m2025-07-18T04:34:11.098310Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752812585805
[2m2025-07-18T04:34:11.098341Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752812585805
[2m2025-07-18T04:34:11.098347Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752812585805
[2m2025-07-18T04:34:11.098350Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752812585805启动Redis频道订阅: ["user:customer_1752812585805:messages", "user:customer_1752812585805:notifications", "system:broadcasts", "session:customer_1752812585805:events"]
[2m2025-07-18T04:34:11.098840Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: user:customer_1752812585805:messages
[2m2025-07-18T04:34:11.098989Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: user:customer_1752812585805:notifications
[2m2025-07-18T04:34:11.099201Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.099457Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: session:customer_1752812585805:events
[2m2025-07-18T04:34:11.099588Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:34:11.099595Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:34:11.099619Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:34:11.099625Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:34:11.099628Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:34:11.100084Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:34:11.100263Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:34:11.100381Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.100537Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:34:11.100796Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752809267952
[2m2025-07-18T04:34:11.100802Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752809267952
[2m2025-07-18T04:34:11.100828Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752809267952
[2m2025-07-18T04:34:11.100842Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752809267952
[2m2025-07-18T04:34:11.100845Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752809267952启动Redis频道订阅: ["user:customer_1752809267952:messages", "user:customer_1752809267952:notifications", "system:broadcasts", "session:customer_1752809267952:events"]
[2m2025-07-18T04:34:11.101325Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为等待客户分配客服: customer_1752813237319 <-> kf001
[2m2025-07-18T04:34:11.101335Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752809267937
[2m2025-07-18T04:34:11.101338Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752809267937
[2m2025-07-18T04:34:11.101342Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.101345Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752809267952
[2m2025-07-18T04:34:11.101355Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752809267952
[2m2025-07-18T04:34:11.101363Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.101381Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.101385Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.101387Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:34:11.101389Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:34:11.101387Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.101392Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.101395Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752812585805
[2m2025-07-18T04:34:11.101399Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.101403Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: user:customer_1752809267952:messages
[2m2025-07-18T04:34:11.101408Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752812585805
[2m2025-07-18T04:34:11.101413Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.101424Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.101609Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: user:customer_1752809267952:notifications
[2m2025-07-18T04:34:11.101770Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.101924Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: session:customer_1752809267952:events
[2m2025-07-18T04:34:11.102757Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m ✅ 客户customer_1752809267952已从等待队列移除
[2m2025-07-18T04:34:11.102909Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🎯 企业级会话已建立: customer_1752809267952 <-> kf001
[2m2025-07-18T04:34:11.102926Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎯 企业级会话已建立: customer_1752809267952 <-> kf001 (增强模式)
[2m2025-07-18T04:34:11.102930Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 会话建立成功: customer_1752809267952 <-> kf001
[2m2025-07-18T04:34:11.102934Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.102937Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752809267952
[2m2025-07-18T04:34:11.102968Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752809267952
[2m2025-07-18T04:34:11.103002Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=UserJoined
[2m2025-07-18T04:34:11.103027Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=UserJoined
[2m2025-07-18T04:34:11.103030Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103053Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103056Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=Welcome
[2m2025-07-18T04:34:11.103060Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=Welcome
[2m2025-07-18T04:34:11.103062Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103069Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103071Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=History
[2m2025-07-18T04:34:11.103074Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=History
[2m2025-07-18T04:34:11.103076Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=UserJoined
[2m2025-07-18T04:34:11.103080Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=UserJoined
[2m2025-07-18T04:34:11.103082Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=UserJoined
[2m2025-07-18T04:34:11.103085Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=UserJoined
[2m2025-07-18T04:34:11.103087Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103103Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103105Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103110Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103112Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.103117Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267952: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104431Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m ✅ 客户customer_1752809267937已从等待队列移除
[2m2025-07-18T04:34:11.104625Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🎯 企业级会话已建立: customer_1752809267937 <-> kf001
[2m2025-07-18T04:34:11.104631Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎯 企业级会话已建立: customer_1752809267937 <-> kf001 (增强模式)
[2m2025-07-18T04:34:11.104634Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 会话建立成功: customer_1752809267937 <-> kf001
[2m2025-07-18T04:34:11.104638Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.104640Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: customer_1752809267937
[2m2025-07-18T04:34:11.104676Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: customer_1752809267937
[2m2025-07-18T04:34:11.104687Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=UserJoined
[2m2025-07-18T04:34:11.104709Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=UserJoined
[2m2025-07-18T04:34:11.104712Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104724Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104727Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=UserJoined
[2m2025-07-18T04:34:11.104732Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=UserJoined
[2m2025-07-18T04:34:11.104734Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=Welcome
[2m2025-07-18T04:34:11.104738Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=Welcome
[2m2025-07-18T04:34:11.104739Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104745Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104747Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=History
[2m2025-07-18T04:34:11.104750Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=History
[2m2025-07-18T04:34:11.104752Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=UserJoined
[2m2025-07-18T04:34:11.104756Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=UserJoined
[2m2025-07-18T04:34:11.104758Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104768Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104771Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104777Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104779Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.104785Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752809267937: 类型=OnlineUsers
[2m2025-07-18T04:34:11.105700Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.105768Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752812585828", "user_id": "customer_1752812585805", "user_type": "kehu"}
[2m2025-07-18T04:34:11.105781Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 94.878µs | 来源: Some(127.0.0.1:63750)
[2m2025-07-18T04:34:11.105813Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752812585805, 用户名=customer_1752812585805, 类型=Kehu
[2m2025-07-18T04:34:11.105816Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752812585805, user_name=customer_1752812585805, user_type=Kehu
[2m2025-07-18T04:34:11.105822Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752812585805
[2m2025-07-18T04:34:11.105825Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752812585805
[2m2025-07-18T04:34:11.105827Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752812585805
[2m2025-07-18T04:34:11.106109Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m ✅ 客户customer_1752813237319已从等待队列移除
[2m2025-07-18T04:34:11.106289Z[0m [32m INFO[0m [2mkefu_system::redis_client[0m[2m:[0m 🎯 企业级会话已建立: customer_1752813237319 <-> kf001
[2m2025-07-18T04:34:11.106299Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎯 企业级会话已建立: customer_1752813237319 <-> kf001 (增强模式)
[2m2025-07-18T04:34:11.106305Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 尝试发送OnlineUsers消息给: kf001
[2m2025-07-18T04:34:11.106308Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送OnlineUsers消息给: kf001
[2m2025-07-18T04:34:11.106311Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 已广播客户列表给所有客服，共4个客户
[2m2025-07-18T04:34:11.106314Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ WebSocket连接初始化完成: kf001
[2m2025-07-18T04:34:11.106347Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务开始: kf001
[2m2025-07-18T04:34:11.106378Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106403Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106406Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:34:11.106410Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=Welcome
[2m2025-07-18T04:34:11.106413Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106423Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106426Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=History
[2m2025-07-18T04:34:11.106429Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=History
[2m2025-07-18T04:34:11.106431Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106435Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106437Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106468Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106471Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106475Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106477Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106480Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106482Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106486Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=UserJoined
[2m2025-07-18T04:34:11.106488Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106498Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106501Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106507Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106510Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106513Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106515Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106521Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106524Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106527Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106529Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106534Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106536Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106540Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=System
[2m2025-07-18T04:34:11.106542Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106547Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 kf001: 类型=OnlineUsers
[2m2025-07-18T04:34:11.106782Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.106827Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "session": "ent_session_1752812591102_mz1k5xuqb4", "timestamp": "2025-07-18T04:33:11.399Z", "session_id": "session_1752813191399", "user_id": "kf001"}
[2m2025-07-18T04:34:11.106835Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 60.214µs | 来源: Some(127.0.0.1:63751)
[2m2025-07-18T04:34:11.106872Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.106875Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.106892Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.106895Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: kf001
[2m2025-07-18T04:34:11.106897Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: kf001
[2m2025-07-18T04:34:11.107646Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752809267937
[2m2025-07-18T04:34:11.107685Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752809267937
[2m2025-07-18T04:34:11.107699Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752809267937
[2m2025-07-18T04:34:11.107702Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752809267937
[2m2025-07-18T04:34:11.107705Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.107708Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752809267937
[2m2025-07-18T04:34:11.107716Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752809267937
[2m2025-07-18T04:34:11.107722Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.107738Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.107750Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752809267937启动Redis频道订阅: ["user:customer_1752809267937:messages", "user:customer_1752809267937:notifications", "system:broadcasts", "session:customer_1752809267937:events"]
[2m2025-07-18T04:34:11.107858Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.107885Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752809278142", "user_type": "kehu", "user_id": "customer_1752809267952"}
[2m2025-07-18T04:34:11.107896Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 53.193µs | 来源: Some(127.0.0.1:63752)
[2m2025-07-18T04:34:11.107921Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752809267952, 用户名=customer_1752809267952, 类型=Kehu
[2m2025-07-18T04:34:11.107923Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752809267952, user_name=customer_1752809267952, user_type=Kehu
[2m2025-07-18T04:34:11.107929Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752809267952
[2m2025-07-18T04:34:11.107932Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752809267952
[2m2025-07-18T04:34:11.107934Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752809267952
[2m2025-07-18T04:34:11.108177Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.108233Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752809267937", "session_id": "session_1752809278019", "user_type": "kehu"}
[2m2025-07-18T04:34:11.108269Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 125.356µs | 来源: Some(127.0.0.1:63753)
[2m2025-07-18T04:34:11.108304Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752809267937, 用户名=customer_1752809267937, 类型=Kehu
[2m2025-07-18T04:34:11.108305Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: user:customer_1752809267937:messages
[2m2025-07-18T04:34:11.108306Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752809267937, user_name=customer_1752809267937, user_type=Kehu
[2m2025-07-18T04:34:11.108329Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752809267937
[2m2025-07-18T04:34:11.108332Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 用户连接信息已保存: customer_1752809267937
[2m2025-07-18T04:34:11.108334Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔄 更新Redis在线状态: customer_1752809267937
[2m2025-07-18T04:34:11.108459Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: user:customer_1752809267937:notifications
[2m2025-07-18T04:34:11.108605Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.108861Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: session:customer_1752809267937:events
[2m2025-07-18T04:34:11.108994Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.109012Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.109167Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.109191Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.109219Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.109231Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.110277Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752812585805
[2m2025-07-18T04:34:11.110284Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752812585805
[2m2025-07-18T04:34:11.110311Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752812585805
[2m2025-07-18T04:34:11.110316Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752812585805
[2m2025-07-18T04:34:11.110319Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.110322Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752812585805
[2m2025-07-18T04:34:11.110327Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752812585805
[2m2025-07-18T04:34:11.110333Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.110349Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.110351Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752812585805启动Redis频道订阅: ["user:customer_1752812585805:messages", "user:customer_1752812585805:notifications", "system:broadcasts", "session:customer_1752812585805:events"]
[2m2025-07-18T04:34:11.110801Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: user:customer_1752812585805:messages
[2m2025-07-18T04:34:11.110973Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: user:customer_1752812585805:notifications
[2m2025-07-18T04:34:11.111149Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.111423Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752812585805已订阅Redis频道: session:customer_1752812585805:events
[2m2025-07-18T04:34:11.111552Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: kf001
[2m2025-07-18T04:34:11.111559Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: kf001
[2m2025-07-18T04:34:11.111583Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: kf001
[2m2025-07-18T04:34:11.111589Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: kf001
[2m2025-07-18T04:34:11.111593Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.111596Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: kf001
[2m2025-07-18T04:34:11.111598Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: kf001
[2m2025-07-18T04:34:11.111603Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.111621Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.111624Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户kf001启动Redis频道订阅: ["user:kf001:messages", "user:kf001:notifications", "system:broadcasts", "session:kf001:events"]
[2m2025-07-18T04:34:11.112124Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:messages
[2m2025-07-18T04:34:11.112303Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: user:kf001:notifications
[2m2025-07-18T04:34:11.112445Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.112571Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户kf001已订阅Redis频道: session:kf001:events
[2m2025-07-18T04:34:11.112925Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.112949Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.113989Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752809267952
[2m2025-07-18T04:34:11.113996Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752809267952
[2m2025-07-18T04:34:11.114023Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752809267952
[2m2025-07-18T04:34:11.114028Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752809267952
[2m2025-07-18T04:34:11.114032Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.114035Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752809267952
[2m2025-07-18T04:34:11.114057Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752809267952
[2m2025-07-18T04:34:11.114068Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.114086Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.114102Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752809267952启动Redis频道订阅: ["user:customer_1752809267952:messages", "user:customer_1752809267952:notifications", "system:broadcasts", "session:customer_1752809267952:events"]
[2m2025-07-18T04:34:11.114571Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: user:customer_1752809267952:messages
[2m2025-07-18T04:34:11.114762Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: user:customer_1752809267952:notifications
[2m2025-07-18T04:34:11.114993Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.115133Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ Redis状态更新成功: customer_1752809267937
[2m2025-07-18T04:34:11.115161Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 启动Redis频道订阅: customer_1752809267937
[2m2025-07-18T04:34:11.115169Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🎉 发送欢迎消息: customer_1752809267937
[2m2025-07-18T04:34:11.115172Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 👥 发送在线用户列表: customer_1752809267937
[2m2025-07-18T04:34:11.115175Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📋 发送在线客户列表: 共4个客户
[2m2025-07-18T04:34:11.115177Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📚 发送历史消息: customer_1752809267937
[2m2025-07-18T04:34:11.115182Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📢 广播用户加入通知: customer_1752809267937
[2m2025-07-18T04:34:11.115201Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.115212Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=UserJoined
[2m2025-07-18T04:34:11.115228Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 为用户customer_1752809267937启动Redis频道订阅: ["user:customer_1752809267937:messages", "user:customer_1752809267937:notifications", "system:broadcasts", "session:customer_1752809267937:events"]
[2m2025-07-18T04:34:11.115290Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267952已订阅Redis频道: session:customer_1752809267952:events
[2m2025-07-18T04:34:11.116559Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.116602Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752809267952请求分配客服
[2m2025-07-18T04:34:11.116608Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752809267952 <-> kf001
[2m2025-07-18T04:34:11.116564Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.116628Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752812585805请求分配客服
[2m2025-07-18T04:34:11.116613Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.116632Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752812585805 <-> kf001
[2m2025-07-18T04:34:11.116672Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.116749Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.116773Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.116821Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📡 实时广播在线状态: 5 个用户在线
[2m2025-07-18T04:34:11.116894Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔍 客户customer_1752809267937请求分配客服
[2m2025-07-18T04:34:11.116831Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📤 准备发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.116905Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🤝 为客户分配客服: customer_1752809267937 <-> kf001
[2m2025-07-18T04:34:11.116937Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功发送消息给 customer_1752813237319: 类型=OnlineUsers
[2m2025-07-18T04:34:11.151564Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.151616Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.151659Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813191399", "timestamp": "2025-07-18T04:33:11.399Z", "user_id": "kf001", "user_type": "kefu", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "priority": "high"}
[2m2025-07-18T04:34:11.151677Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 132.586µs | 来源: Some(127.0.0.1:63754)
[2m2025-07-18T04:34:11.151707Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "user_id": "kf001", "session_id": "session_1752813195341", "user_name": "kf001", "timestamp": "2025-07-18T04:33:15.341Z"}
[2m2025-07-18T04:34:11.151722Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 126.647µs | 来源: Some(127.0.0.1:63755)
[2m2025-07-18T04:34:11.151769Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.151773Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.151778Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.151801Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.151808Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.151815Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.152439Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: user:customer_1752809267937:messages
[2m2025-07-18T04:34:11.152646Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: user:customer_1752809267937:notifications
[2m2025-07-18T04:34:11.153104Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: system:broadcasts
[2m2025-07-18T04:34:11.153351Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 用户customer_1752809267937已订阅Redis频道: session:customer_1752809267937:events
[2m2025-07-18T04:34:11.158769Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.158859Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session_id": "session_1752813191401", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "user_name": "kf001", "quality": "high_performance", "timestamp": "2025-07-18T04:33:11.401Z"}
[2m2025-07-18T04:34:11.158875Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 124.554µs | 来源: Some(127.0.0.1:63756)
[2m2025-07-18T04:34:11.158908Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.158912Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.158919Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.159570Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.159637Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:33:15.342Z", "session_id": "session_1752813195342", "user_name": "kf001", "user_id": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:34:11.159662Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 109.911µs | 来源: Some(127.0.0.1:63757)
[2m2025-07-18T04:34:11.159707Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.159713Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.159726Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.165474Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.165552Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "quality": "high_performance", "user_id": "kf001", "timestamp": "2025-07-18T04:33:12.406Z", "priority": "high", "user_name": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "session_id": "session_1752813192406", "connection_id": "ent_conn_1752812591102_275op2qz4kt"}
[2m2025-07-18T04:34:11.165570Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 119.295µs | 来源: Some(127.0.0.1:63758)
[2m2025-07-18T04:34:11.165604Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.165608Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.165617Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.166145Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.166177Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "session_id": "session_1752813196352", "timestamp": "2025-07-18T04:33:16.352Z", "user_id": "kf001", "user_name": "kf001"}
[2m2025-07-18T04:34:11.166195Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 60.183µs | 来源: Some(127.0.0.1:63760)
[2m2025-07-18T04:34:11.166218Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.166221Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.166227Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.171709Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.171784Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813192407", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "user_name": "kf001", "timestamp": "2025-07-18T04:33:12.407Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:34:11.171798Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 102.229µs | 来源: Some(127.0.0.1:63762)
[2m2025-07-18T04:34:11.171834Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.171837Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.171843Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.172785Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.172823Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "user_type": "kefu", "session_id": "session_1752813196353", "user_id": "kf001", "timestamp": "2025-07-18T04:33:16.353Z"}
[2m2025-07-18T04:34:11.172835Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 59.583µs | 来源: Some(127.0.0.1:63764)
[2m2025-07-18T04:34:11.172860Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.172863Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.172867Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.177930Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.177984Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "user_id": "kf001", "priority": "high", "quality": "high_performance", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "timestamp": "2025-07-18T04:33:12.407Z", "session_id": "session_1752813192407"}
[2m2025-07-18T04:34:11.177993Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 78.793µs | 来源: Some(127.0.0.1:63765)
[2m2025-07-18T04:34:11.178019Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.178023Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.178037Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.181444Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.181508Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813192408", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "user_name": "kf001", "priority": "high", "user_type": "kefu", "timestamp": "2025-07-18T04:33:12.408Z", "quality": "high_performance"}
[2m2025-07-18T04:34:11.181523Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 90.01µs | 来源: Some(127.0.0.1:63766)
[2m2025-07-18T04:34:11.181551Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.181555Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.181558Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.184471Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.184527Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "quality": "high_performance", "user_name": "kf001", "timestamp": "2025-07-18T04:33:12.409Z", "session_id": "session_1752813192409", "user_id": "kf001", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "priority": "high"}
[2m2025-07-18T04:34:11.184537Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 77.36µs | 来源: Some(127.0.0.1:63767)
[2m2025-07-18T04:34:11.184565Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.184568Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.184574Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.188558Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.188618Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752812591102_mz1k5xuqb4", "timestamp": "2025-07-18T04:33:13.414Z", "priority": "high", "quality": "high_performance", "user_name": "kf001", "session_id": "session_1752813193414", "user_type": "kefu", "user_id": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt"}
[2m2025-07-18T04:34:11.188632Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 84.953µs | 来源: Some(127.0.0.1:63768)
[2m2025-07-18T04:34:11.188673Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.188676Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.188679Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.191925Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.191968Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "timestamp": "2025-07-18T04:33:13.416Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "session_id": "session_1752813193416", "quality": "high_performance", "user_id": "kf001", "user_name": "kf001"}
[2m2025-07-18T04:34:11.191985Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 71.211µs | 来源: Some(127.0.0.1:63770)
[2m2025-07-18T04:34:11.192010Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.192013Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.192019Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.195117Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.195157Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813193417", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "timestamp": "2025-07-18T04:33:13.417Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "quality": "high_performance", "user_name": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:34:11.195169Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 67.655µs | 来源: Some(127.0.0.1:63771)
[2m2025-07-18T04:34:11.195193Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.195196Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.195199Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.198535Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.198593Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "user_type": "kefu", "priority": "high", "session_id": "session_1752813194424", "timestamp": "2025-07-18T04:33:14.424Z", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_id": "kf001"}
[2m2025-07-18T04:34:11.198607Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 84.692µs | 来源: Some(127.0.0.1:63772)
[2m2025-07-18T04:34:11.198637Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.198640Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.198645Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.201427Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.201530Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "user_id": "kf001", "quality": "high_performance", "session_id": "session_1752813194425", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "session": "ent_session_1752812591102_mz1k5xuqb4", "timestamp": "2025-07-18T04:33:14.425Z"}
[2m2025-07-18T04:34:11.201548Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 142.632µs | 来源: Some(127.0.0.1:63773)
[2m2025-07-18T04:34:11.201598Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.201602Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.201608Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.205430Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.205525Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813194425", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "quality": "high_performance", "user_name": "kf001", "priority": "high", "timestamp": "2025-07-18T04:33:14.425Z", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_type": "kefu"}
[2m2025-07-18T04:34:11.205553Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 144.926µs | 来源: Some(127.0.0.1:63775)
[2m2025-07-18T04:34:11.205604Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.205610Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.205622Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.208643Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.208711Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "quality": "high_performance", "priority": "high", "user_name": "kf001", "timestamp": "2025-07-18T04:33:14.427Z", "user_id": "kf001", "session_id": "session_1752813194427", "connection_id": "ent_conn_1752812591102_275op2qz4kt"}
[2m2025-07-18T04:34:11.208735Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 108.589µs | 来源: Some(127.0.0.1:63776)
[2m2025-07-18T04:34:11.208780Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.208785Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.208795Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.211501Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.211541Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "user_type": "kefu", "session_id": "session_1752813195434", "user_id": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "quality": "high_performance", "timestamp": "2025-07-18T04:33:15.434Z"}
[2m2025-07-18T04:34:11.211553Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 63.169µs | 来源: Some(127.0.0.1:63777)
[2m2025-07-18T04:34:11.211580Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.211582Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.211597Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.214378Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.214415Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "session_id": "session_1752813195435", "quality": "high_performance", "session": "ent_session_1752812591102_mz1k5xuqb4", "timestamp": "2025-07-18T04:33:15.435Z", "user_name": "kf001", "user_id": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high"}
[2m2025-07-18T04:34:11.214428Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 59.613µs | 来源: Some(127.0.0.1:63778)
[2m2025-07-18T04:34:11.214451Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.214454Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.214459Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.216923Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.216966Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:33:15.436Z", "session_id": "session_1752813195436", "user_id": "kf001", "user_type": "kefu", "user_name": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "priority": "high", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt"}
[2m2025-07-18T04:34:11.216979Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 66.293µs | 来源: Some(127.0.0.1:63779)
[2m2025-07-18T04:34:11.217003Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.217005Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.217010Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.219548Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.219590Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:33:15.437Z", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_type": "kefu", "session_id": "session_1752813195437", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "user_name": "kf001", "quality": "high_performance", "priority": "high"}
[2m2025-07-18T04:34:11.219604Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 66.173µs | 来源: Some(127.0.0.1:63780)
[2m2025-07-18T04:34:11.219630Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.219632Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.219639Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.223579Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.223672Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "session_id": "session_1752813196490", "priority": "high", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_name": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "timestamp": "2025-07-18T04:33:16.490Z"}
[2m2025-07-18T04:34:11.223704Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 141.09µs | 来源: Some(127.0.0.1:63781)
[2m2025-07-18T04:34:11.223739Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.223743Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.223749Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.227072Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.227118Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813196491", "priority": "high", "timestamp": "2025-07-18T04:33:16.491Z", "quality": "high_performance", "user_type": "kefu", "user_name": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt"}
[2m2025-07-18T04:34:11.227132Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 72.073µs | 来源: Some(127.0.0.1:63782)
[2m2025-07-18T04:34:11.227157Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.227160Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.227166Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.231269Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.231317Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_type": "kefu", "user_id": "kf001", "user_name": "kf001", "priority": "high", "quality": "high_performance", "timestamp": "2025-07-18T04:33:16.491Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "session_id": "session_1752813196491"}
[2m2025-07-18T04:34:11.231331Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 72.914µs | 来源: Some(127.0.0.1:63783)
[2m2025-07-18T04:34:11.231394Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.231403Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.231411Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.234398Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.234484Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "timestamp": "2025-07-18T04:33:16.492Z", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "quality": "high_performance", "priority": "high", "session_id": "session_1752813196492"}
[2m2025-07-18T04:34:11.234502Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 116.193µs | 来源: Some(127.0.0.1:63784)
[2m2025-07-18T04:34:11.234608Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.234621Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.234656Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.237974Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.238050Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "user_id": "kf001", "session_id": "session_1752813196493", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_name": "kf001", "timestamp": "2025-07-18T04:33:16.493Z", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance"}
[2m2025-07-18T04:34:11.238061Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 102.11µs | 来源: Some(127.0.0.1:63785)
[2m2025-07-18T04:34:11.238095Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.238098Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.238105Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.241251Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.241306Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "user_name": "kf001", "priority": "high", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "quality": "high_performance", "session_id": "session_1752813197502", "session": "ent_session_1752812591102_mz1k5xuqb4", "timestamp": "2025-07-18T04:33:17.502Z", "user_type": "kefu"}
[2m2025-07-18T04:34:11.241319Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 79.976µs | 来源: Some(127.0.0.1:63786)
[2m2025-07-18T04:34:11.241349Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.241352Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.241355Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.244565Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.244624Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752812591102_mz1k5xuqb4", "user_id": "kf001", "timestamp": "2025-07-18T04:33:17.503Z", "priority": "high", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "session_id": "session_1752813197503"}
[2m2025-07-18T04:34:11.244633Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 79.745µs | 来源: Some(127.0.0.1:63789)
[2m2025-07-18T04:34:11.244662Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.244665Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.244671Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.247704Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.247756Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "user_type": "kefu", "user_id": "kf001", "quality": "high_performance", "timestamp": "2025-07-18T04:33:17.504Z", "session_id": "session_1752813197504", "priority": "high", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4"}
[2m2025-07-18T04:34:11.247770Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 77.161µs | 来源: Some(127.0.0.1:63790)
[2m2025-07-18T04:34:11.247797Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.247801Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.247804Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.251276Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.251321Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "session_id": "session_1752813197504", "session": "ent_session_1752812591102_mz1k5xuqb4", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_name": "kf001", "priority": "high", "user_type": "kefu", "timestamp": "2025-07-18T04:33:17.504Z", "user_id": "kf001"}
[2m2025-07-18T04:34:11.251329Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 71.111µs | 来源: Some(127.0.0.1:63791)
[2m2025-07-18T04:34:11.251395Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.251411Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.251421Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.254588Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.254651Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "quality": "high_performance", "session_id": "session_1752813197505", "user_id": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "timestamp": "2025-07-18T04:33:17.505Z", "priority": "high"}
[2m2025-07-18T04:34:11.254676Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 111.165µs | 来源: Some(127.0.0.1:63792)
[2m2025-07-18T04:34:11.254723Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.254729Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.254741Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.257248Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.257286Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "user_name": "kf001", "user_id": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_type": "kefu", "session_id": "session_1752813197506", "timestamp": "2025-07-18T04:33:17.506Z"}
[2m2025-07-18T04:34:11.257307Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 69.048µs | 来源: Some(127.0.0.1:63793)
[2m2025-07-18T04:34:11.257331Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.257334Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.257337Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.259913Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.259981Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "session_id": "session_1752813198508", "user_id": "kf001", "timestamp": "2025-07-18T04:33:18.508Z"}
[2m2025-07-18T04:34:11.260006Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 111.055µs | 来源: Some(127.0.0.1:63794)
[2m2025-07-18T04:34:11.260052Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.260058Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.260070Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.263533Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.263609Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "timestamp": "2025-07-18T04:33:18.509Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "quality": "high_performance", "user_id": "kf001", "user_type": "kefu", "priority": "high", "session_id": "session_1752813198509"}
[2m2025-07-18T04:34:11.263619Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 95.94µs | 来源: Some(127.0.0.1:63795)
[2m2025-07-18T04:34:11.263653Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.263657Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.263667Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.266519Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.266570Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "session_id": "session_1752813198510", "user_name": "kf001", "timestamp": "2025-07-18T04:33:18.510Z", "priority": "high", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "quality": "high_performance"}
[2m2025-07-18T04:34:11.266583Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 76.319µs | 来源: Some(127.0.0.1:63796)
[2m2025-07-18T04:34:11.266620Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.266624Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.266641Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.270069Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.270130Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:33:18.510Z", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session_id": "session_1752813198510", "user_name": "kf001", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "priority": "high", "user_type": "kefu", "user_id": "kf001"}
[2m2025-07-18T04:34:11.270139Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 82.48µs | 来源: Some(127.0.0.1:63797)
[2m2025-07-18T04:34:11.270173Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.270177Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.270183Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.272576Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.272616Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "priority": "high", "timestamp": "2025-07-18T04:33:18.511Z", "session_id": "session_1752813198511", "user_id": "kf001", "quality": "high_performance", "user_name": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4"}
[2m2025-07-18T04:34:11.272624Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 58.021µs | 来源: Some(127.0.0.1:63799)
[2m2025-07-18T04:34:11.272646Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.272649Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.272652Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.275215Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.275248Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "priority": "high", "user_name": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "session_id": "session_1752813199521", "timestamp": "2025-07-18T04:33:19.521Z", "user_id": "kf001"}
[2m2025-07-18T04:34:11.275255Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 53.314µs | 来源: Some(127.0.0.1:63800)
[2m2025-07-18T04:34:11.275279Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.275282Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.275287Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.277892Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.277933Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "user_name": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session_id": "session_1752813199521", "timestamp": "2025-07-18T04:33:19.521Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "user_id": "kf001", "priority": "high"}
[2m2025-07-18T04:34:11.277940Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 57.901µs | 来源: Some(127.0.0.1:63801)
[2m2025-07-18T04:34:11.277964Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.277967Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.277972Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.280918Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.281003Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "user_id": "kf001", "user_name": "kf001", "timestamp": "2025-07-18T04:33:19.521Z", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session_id": "session_1752813199521"}
[2m2025-07-18T04:34:11.281019Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 122.372µs | 来源: Some(127.0.0.1:63802)
[2m2025-07-18T04:34:11.281071Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.281077Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.281088Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.283647Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.283719Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:33:19.522Z", "quality": "high_performance", "user_name": "kf001", "user_id": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "user_type": "kefu", "priority": "high", "session": "ent_session_1752812591102_mz1k5xuqb4", "session_id": "session_1752813199522"}
[2m2025-07-18T04:34:11.283729Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 96.181µs | 来源: Some(127.0.0.1:63803)
[2m2025-07-18T04:34:11.283761Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.283764Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.283768Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.286229Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.286268Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "session_id": "session_1752813199522", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_name": "kf001", "user_id": "kf001", "priority": "high", "quality": "high_performance", "timestamp": "2025-07-18T04:33:19.522Z"}
[2m2025-07-18T04:34:11.286286Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 70.461µs | 来源: Some(127.0.0.1:63804)
[2m2025-07-18T04:34:11.286312Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.286315Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.286319Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.289247Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.289303Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "user_id": "kf001", "priority": "high", "quality": "high_performance", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "session_id": "session_1752813199523", "timestamp": "2025-07-18T04:33:19.523Z", "user_name": "kf001"}
[2m2025-07-18T04:34:11.289319Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 83.712µs | 来源: Some(127.0.0.1:63805)
[2m2025-07-18T04:34:11.289346Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.289350Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.289356Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.291784Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.291824Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "session": "ent_session_1752812591102_mz1k5xuqb4", "session_id": "session_1752813199524", "quality": "high_performance", "user_type": "kefu", "timestamp": "2025-07-18T04:33:19.524Z", "user_id": "kf001", "user_name": "kf001", "priority": "high"}
[2m2025-07-18T04:34:11.291832Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 57.08µs | 来源: Some(127.0.0.1:63806)
[2m2025-07-18T04:34:11.291856Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.291858Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.291864Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.294331Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.294362Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "quality": "high_performance", "user_name": "kf001", "timestamp": "2025-07-18T04:33:20.530Z", "user_id": "kf001", "user_type": "kefu", "session": "ent_session_1752812591102_mz1k5xuqb4", "session_id": "session_1752813200530", "priority": "high"}
[2m2025-07-18T04:34:11.294369Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 47.755µs | 来源: Some(127.0.0.1:63807)
[2m2025-07-18T04:34:11.294402Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.294413Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.294422Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.297616Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.297657Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752812591102_275op2qz4kt", "quality": "high_performance", "session": "ent_session_1752812591102_mz1k5xuqb4", "priority": "high", "timestamp": "2025-07-18T04:33:25.639Z", "user_type": "kefu", "user_id": "kf001", "user_name": "kf001", "session_id": "session_1752813205639"}
[2m2025-07-18T04:34:11.297665Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 58.402µs | 来源: Some(127.0.0.1:63808)
[2m2025-07-18T04:34:11.297691Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.297694Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.297697Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.300377Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.300420Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "priority": "high", "session_id": "session_1752813205640", "user_id": "kf001", "quality": "high_performance", "timestamp": "2025-07-18T04:33:25.640Z", "user_name": "kf001"}
[2m2025-07-18T04:34:11.300428Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 66.795µs | 来源: Some(127.0.0.1:63812)
[2m2025-07-18T04:34:11.300456Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.300458Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.300469Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.302767Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:11.302802Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "session_id": "session_1752813206705", "connection_id": "ent_conn_1752812591102_275op2qz4kt", "timestamp": "2025-07-18T04:33:26.705Z", "quality": "high_performance", "user_id": "kf001", "priority": "high", "session": "ent_session_1752812591102_mz1k5xuqb4", "user_type": "kefu"}
[2m2025-07-18T04:34:11.302815Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 60.175µs | 来源: Some(127.0.0.1:63813)
[2m2025-07-18T04:34:11.302839Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:11.302842Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:11.302846Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:11.693466Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=125
[2m2025-07-18T04:34:11.693509Z[0m [33m WARN[0m [2mkefu_system::websocket[0m[2m:[0m ⚠️ JSON解析失败: unknown variant `heartbeat`, expected one of `Chat`, `System`, `Typing`, `Heartbeat`, `History`, `HistoryRequest`, `OnlineUsers`, `UserJoined`, `UserLeft`, `Status`, `Welcome`, `Error`, `HtmlTemplate`, `HtmlCallback`, `VoiceMessage` at line 1 column 53, 当作文本消息处理
[2m2025-07-18T04:34:11.693512Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 处理文本消息: kf001 -> '{"id":"msg_1752813251689_gycva21v","type":"heartbeat","content":"ping","from":"kf001","timestamp":"2025-07-18T04:34:11.689Z"}'
[2m2025-07-18T04:34:18.964750Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:34:19.810626Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 kf001: 长度=0
[2m2025-07-18T04:34:19.810674Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 接收任务结束: kf001
[2m2025-07-18T04:34:19.956651Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:19.956767Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813259941", "session": "ent_session_1752813259908_sjs59db08xh", "user_name": "kf001", "user_id": "kf001", "connection_id": "ent_conn_1752813259908_i0rgvcnl0yj", "user_type": "kefu", "priority": "high", "quality": "high_performance", "timestamp": "2025-07-18T04:34:19.941Z"}
[2m2025-07-18T04:34:19.956782Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 160.28µs | 来源: Some(127.0.0.1:64201)
[2m2025-07-18T04:34:19.956838Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:19.956843Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:19.956849Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:19.968413Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:19.968526Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "user_name": "kf001", "session_id": "session_1752813259943", "connection_id": "ent_conn_1752813259908_i0rgvcnl0yj", "user_type": "kefu", "timestamp": "2025-07-18T04:34:19.943Z", "user_id": "kf001", "session": "ent_session_1752813259908_sjs59db08xh", "priority": "high"}
[2m2025-07-18T04:34:19.968559Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 171.067µs | 来源: Some(127.0.0.1:64203)
[2m2025-07-18T04:34:19.968627Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:19.968637Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:19.968652Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:22.195613Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:22.195759Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813262146_yatmtco861", "user_id": "kf001", "quality": "high_performance", "user_name": "kf001", "user_type": "kefu", "timestamp": "2025-07-18T04:34:22.181Z", "connection_id": "ent_conn_1752813262146_p7n3iafgbnf", "session_id": "session_1752813262181", "priority": "high"}
[2m2025-07-18T04:34:22.196017Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 447.668µs | 来源: Some(127.0.0.1:64289)
[2m2025-07-18T04:34:22.196061Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:22.196065Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:22.196075Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:22.207306Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:34:22.207403Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752813262146_p7n3iafgbnf", "user_name": "kf001", "timestamp": "2025-07-18T04:34:22.182Z", "priority": "high", "quality": "high_performance", "session": "ent_session_1752813262146_yatmtco861", "session_id": "session_1752813262182", "user_id": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:34:22.207425Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 138.727µs | 来源: Some(127.0.0.1:64293)
[2m2025-07-18T04:34:22.207475Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:34:22.207482Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:34:22.207496Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:34:27.353755Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813237319: 长度=59
[2m2025-07-18T04:34:27.353833Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:34:27.352Z }
[2m2025-07-18T04:34:27.353848Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752813237319, 使用连接ID
[2m2025-07-18T04:34:27.353854Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752813237319
[2m2025-07-18T04:34:27.649358Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813237319: 长度=59
[2m2025-07-18T04:34:27.649406Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:34:27.347Z }
[2m2025-07-18T04:34:27.649414Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752813237319, 使用连接ID
[2m2025-07-18T04:34:27.649419Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752813237319
[2m2025-07-18T04:34:37.382745Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752813237319: 长度=59
[2m2025-07-18T04:34:37.382795Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:34:37.380Z }
[2m2025-07-18T04:34:37.382803Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752813237319, 使用连接ID
[2m2025-07-18T04:34:37.382807Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752813237319
[2m2025-07-18T04:34:41.856921Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752809267937: 长度=59
[2m2025-07-18T04:34:41.857129Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:34:41.857Z }
[2m2025-07-18T04:34:41.857136Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752809267937, 使用连接ID
[2m2025-07-18T04:34:41.857139Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752809267937
[2m2025-07-18T04:34:41.902786Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752809267952: 长度=59
[2m2025-07-18T04:34:41.902810Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:34:41.902Z }
[2m2025-07-18T04:34:41.902846Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752809267952, 使用连接ID
[2m2025-07-18T04:34:41.902850Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752809267952
[2m2025-07-18T04:34:41.948238Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📥 收到WebSocket消息从 customer_1752812585805: 长度=59
[2m2025-07-18T04:34:41.948279Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m ✅ 成功解析为AppMessage: Heartbeat { user_id: None, timestamp: 2025-07-18T04:34:41.948Z }
[2m2025-07-18T04:34:41.948286Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 处理心跳消息: 消息user_id=None, 连接user_id=customer_1752812585805, 使用连接ID
[2m2025-07-18T04:34:41.948289Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🫀 发送心跳响应给: customer_1752812585805
[2m2025-07-18T04:34:48.964538Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:35:06.363772Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:35:06.363906Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "quality": "high_performance", "session": "ent_session_1752813306319_hk64g8p53qo", "session_id": "session_1752813306352", "connection_id": "ent_conn_1752813306319_0opk7g83nyd", "timestamp": "2025-07-18T04:35:06.352Z", "user_id": "kf001", "user_name": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:35:06.363935Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 180.601µs | 来源: Some(127.0.0.1:49637)
[2m2025-07-18T04:35:06.363973Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:35:06.363978Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:35:06.363986Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:35:06.377787Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:35:06.377870Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813306319_hk64g8p53qo", "priority": "high", "connection_id": "ent_conn_1752813306319_0opk7g83nyd", "session_id": "session_1752813306354", "user_id": "kf001", "user_type": "kefu", "user_name": "kf001", "timestamp": "2025-07-18T04:35:06.354Z", "quality": "high_performance"}
[2m2025-07-18T04:35:06.377883Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 113.146µs | 来源: Some(127.0.0.1:49639)
[2m2025-07-18T04:35:06.377980Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:35:06.377986Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:35:06.377992Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:35:18.964580Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:35:24.931762Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:35:24.931900Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752813324920", "session_id": "session_1752813324929", "user_type": "kehu"}
[2m2025-07-18T04:35:24.931924Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 191.178µs | 来源: Some(127.0.0.1:50789)
[2m2025-07-18T04:35:24.931990Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813324920, 用户名=customer_1752813324920, 类型=Kehu
[2m2025-07-18T04:35:24.932000Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813324920, user_name=customer_1752813324920, user_type=Kehu
[2m2025-07-18T04:35:24.932015Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813324920
[2m2025-07-18T04:35:24.950456Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:35:24.950560Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "session_id": "session_1752813324930", "user_id": "customer_1752813324920"}
[2m2025-07-18T04:35:24.950575Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 140.88µs | 来源: Some(127.0.0.1:50792)
[2m2025-07-18T04:35:24.950640Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813324920, 用户名=customer_1752813324920, 类型=Kehu
[2m2025-07-18T04:35:24.950646Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813324920, user_name=customer_1752813324920, user_type=Kehu
[2m2025-07-18T04:35:24.950657Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813324920
[2m2025-07-18T04:35:34.955127Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:35:34.955234Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752813324920", "session_id": "session_1752813334952", "user_type": "kehu"}
[2m2025-07-18T04:35:34.955254Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 145.366µs | 来源: Some(127.0.0.1:51203)
[2m2025-07-18T04:35:34.955310Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813324920, 用户名=customer_1752813324920, 类型=Kehu
[2m2025-07-18T04:35:34.955315Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813324920, user_name=customer_1752813324920, user_type=Kehu
[2m2025-07-18T04:35:34.955324Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813324920
[2m2025-07-18T04:35:48.964226Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:36:18.963890Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:36:26.889495Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:26.889611Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "priority": "high", "user_type": "kefu", "timestamp": "2025-07-18T04:36:26.885Z", "connection_id": "ent_conn_1752813386858_aux7yf9uwpv", "session": "ent_session_1752813386858_9trsieo3pi5", "user_id": "kf001", "quality": "high_performance", "session_id": "session_1752813386885"}
[2m2025-07-18T04:36:26.889633Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 158.527µs | 来源: Some(127.0.0.1:53514)
[2m2025-07-18T04:36:26.889687Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:26.889693Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:26.889700Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:26.902281Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:26.902385Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "quality": "high_performance", "session": "ent_session_1752813386858_9trsieo3pi5", "user_type": "kefu", "priority": "high", "connection_id": "ent_conn_1752813386858_aux7yf9uwpv", "session_id": "session_1752813386886", "user_id": "kf001", "timestamp": "2025-07-18T04:36:26.886Z"}
[2m2025-07-18T04:36:26.902405Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 140.99µs | 来源: Some(127.0.0.1:53517)
[2m2025-07-18T04:36:26.902441Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:26.902446Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:26.902456Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:48.964302Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:36:49.008493Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:49.008606Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "timestamp": "2025-07-18T04:36:49.002Z", "user_id": "kf001", "connection_id": "ent_conn_1752813408977_ad6oyzt9r2p", "session_id": "session_1752813409002", "session": "ent_session_1752813408977_gjybgml46fv", "priority": "high"}
[2m2025-07-18T04:36:49.008621Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 147.69µs | 来源: Some(127.0.0.1:58469)
[2m2025-07-18T04:36:49.008681Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:49.008687Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:49.008695Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:49.047623Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:49.047740Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "timestamp": "2025-07-18T04:36:49.003Z", "session": "ent_session_1752813408977_gjybgml46fv", "priority": "high", "user_name": "kf001", "session_id": "session_1752813409003", "user_id": "kf001", "connection_id": "ent_conn_1752813408977_ad6oyzt9r2p", "quality": "high_performance"}
[2m2025-07-18T04:36:49.047754Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 149.213µs | 来源: Some(127.0.0.1:58476)
[2m2025-07-18T04:36:49.047796Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:49.047800Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:49.047805Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:49.288980Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:49.289091Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "session_id": "session_1752813409285", "connection_id": "ent_conn_1752813409260_7oclxcg2cwq", "timestamp": "2025-07-18T04:36:49.285Z", "session": "ent_session_1752813409260_2gb18t8f51d", "user_id": "kf001", "user_name": "kf001", "priority": "high", "user_type": "kefu"}
[2m2025-07-18T04:36:49.289110Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 150.455µs | 来源: Some(127.0.0.1:58487)
[2m2025-07-18T04:36:49.289150Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:49.289154Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:49.289160Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:49.304310Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:49.304428Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "priority": "high", "user_id": "kf001", "user_name": "kf001", "connection_id": "ent_conn_1752813409260_7oclxcg2cwq", "quality": "high_performance", "session": "ent_session_1752813409260_2gb18t8f51d", "session_id": "session_1752813409286", "timestamp": "2025-07-18T04:36:49.286Z"}
[2m2025-07-18T04:36:49.304443Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 157.145µs | 来源: Some(127.0.0.1:58494)
[2m2025-07-18T04:36:49.304493Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:49.304497Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:49.304502Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:49.568300Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:49.568406Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "session": "ent_session_1752813409539_nmpet2i0job", "user_id": "kf001", "user_type": "kefu", "session_id": "session_1752813409563", "priority": "high", "user_name": "kf001", "connection_id": "ent_conn_1752813409539_fu6p9bhy15", "timestamp": "2025-07-18T04:36:49.563Z"}
[2m2025-07-18T04:36:49.568435Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 154.872µs | 来源: Some(127.0.0.1:58512)
[2m2025-07-18T04:36:49.568489Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:49.568493Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:49.568501Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:36:49.583901Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:36:49.584009Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "priority": "high", "quality": "high_performance", "session": "ent_session_1752813409539_nmpet2i0job", "connection_id": "ent_conn_1752813409539_fu6p9bhy15", "session_id": "session_1752813409564", "timestamp": "2025-07-18T04:36:49.564Z", "user_id": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:36:49.584023Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 140.059µs | 来源: Some(127.0.0.1:58514)
[2m2025-07-18T04:36:49.584063Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:36:49.584067Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:36:49.584076Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:02.560099Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:37:02.560216Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813422554", "session": "ent_session_1752813422530_gfzuacwvlq9", "quality": "high_performance", "user_name": "kf001", "user_type": "kefu", "priority": "high", "user_id": "kf001", "connection_id": "ent_conn_1752813422530_sjwaceij1m", "timestamp": "2025-07-18T04:37:02.554Z"}
[2m2025-07-18T04:37:02.560236Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 159.91µs | 来源: Some(127.0.0.1:59198)
[2m2025-07-18T04:37:02.560278Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:37:02.560283Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:37:02.560291Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:02.574854Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:37:02.574962Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "user_id": "kf001", "priority": "high", "user_type": "kefu", "session_id": "session_1752813422556", "user_name": "kf001", "connection_id": "ent_conn_1752813422530_sjwaceij1m", "timestamp": "2025-07-18T04:37:02.556Z", "session": "ent_session_1752813422530_gfzuacwvlq9"}
[2m2025-07-18T04:37:02.574978Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 143.184µs | 来源: Some(127.0.0.1:59200)
[2m2025-07-18T04:37:02.575022Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:37:02.575039Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:37:02.575046Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:02.716263Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:37:02.716406Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813422690_1yqpzqdt9z5", "session_id": "session_1752813422711", "quality": "high_performance", "user_type": "kefu", "user_name": "kf001", "timestamp": "2025-07-18T04:37:02.711Z", "user_id": "kf001", "connection_id": "ent_conn_1752813422690_gmoh2p413t8", "priority": "high"}
[2m2025-07-18T04:37:02.716427Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 190.388µs | 来源: Some(127.0.0.1:59210)
[2m2025-07-18T04:37:02.716491Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:37:02.716497Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:37:02.716511Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:02.728412Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:37:02.728520Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813422712", "connection_id": "ent_conn_1752813422690_gmoh2p413t8", "session": "ent_session_1752813422690_1yqpzqdt9z5", "timestamp": "2025-07-18T04:37:02.712Z", "user_type": "kefu", "user_id": "kf001", "quality": "high_performance", "user_name": "kf001", "priority": "high"}
[2m2025-07-18T04:37:02.728539Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 151.366µs | 来源: Some(127.0.0.1:59212)
[2m2025-07-18T04:37:02.728602Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:37:02.728609Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:37:02.728617Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:02.900176Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:37:02.900282Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:37:02.892Z", "session_id": "session_1752813422892", "connection_id": "ent_conn_1752813422870_ezl0pip0ipg", "session": "ent_session_1752813422870_k95nt0e6ny", "user_id": "kf001", "quality": "high_performance", "priority": "high", "user_type": "kefu", "user_name": "kf001"}
[2m2025-07-18T04:37:02.900295Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 136.984µs | 来源: Some(127.0.0.1:59226)
[2m2025-07-18T04:37:02.900341Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:37:02.900345Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:37:02.900351Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:02.912889Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:37:02.913010Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "connection_id": "ent_conn_1752813422870_ezl0pip0ipg", "session": "ent_session_1752813422870_k95nt0e6ny", "user_type": "kefu", "quality": "high_performance", "user_name": "kf001", "session_id": "session_1752813422893", "timestamp": "2025-07-18T04:37:02.893Z", "priority": "high"}
[2m2025-07-18T04:37:02.913024Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 153.831µs | 来源: Some(127.0.0.1:59228)
[2m2025-07-18T04:37:02.913073Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:37:02.913077Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:37:02.913082Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:37:18.964590Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:37:48.964454Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:38:18.786008Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:18.786139Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "user_name": "kf001", "session": "ent_session_1752813498756_jhl3x99ej9o", "user_type": "kefu", "priority": "high", "quality": "high_performance", "session_id": "session_1752813498781", "timestamp": "2025-07-18T04:38:18.781Z", "connection_id": "ent_conn_1752813498756_cdakhvunueo"}
[2m2025-07-18T04:38:18.786158Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 174.693µs | 来源: Some(127.0.0.1:62069)
[2m2025-07-18T04:38:18.786219Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:18.786229Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:18.786238Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:18.797760Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:18.797867Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "quality": "high_performance", "user_name": "kf001", "user_type": "kefu", "session": "ent_session_1752813498756_jhl3x99ej9o", "session_id": "session_1752813498782", "priority": "high", "timestamp": "2025-07-18T04:38:18.782Z", "connection_id": "ent_conn_1752813498756_cdakhvunueo"}
[2m2025-07-18T04:38:18.797885Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 149.483µs | 来源: Some(127.0.0.1:62071)
[2m2025-07-18T04:38:18.797921Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:18.797927Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:18.797936Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:18.964082Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:38:22.004034Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.004146Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:38:21.999Z", "user_name": "kf001", "user_id": "kf001", "session_id": "session_1752813501999", "session": "ent_session_1752813501977_gxjn0mi7nwa", "priority": "high", "quality": "high_performance", "user_type": "kefu", "connection_id": "ent_conn_1752813501977_ttrmwffohwj"}
[2m2025-07-18T04:38:22.004163Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 152.137µs | 来源: Some(127.0.0.1:62198)
[2m2025-07-18T04:38:22.004208Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.004214Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.004223Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.018868Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.018978Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "session_id": "session_1752813502000", "user_type": "kefu", "priority": "high", "timestamp": "2025-07-18T04:38:22.000Z", "session": "ent_session_1752813501977_gxjn0mi7nwa", "user_id": "kf001", "user_name": "kf001", "connection_id": "ent_conn_1752813501977_ttrmwffohwj"}
[2m2025-07-18T04:38:22.018994Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 161.532µs | 来源: Some(127.0.0.1:62201)
[2m2025-07-18T04:38:22.019051Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.019057Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.019065Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.183002Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.183114Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "session_id": "session_1752813502180", "session": "ent_session_1752813502155_8qpulnoceui", "user_id": "kf001", "user_type": "kefu", "quality": "high_performance", "user_name": "kf001", "connection_id": "ent_conn_1752813502155_t2k0ksr7tyb", "timestamp": "2025-07-18T04:38:22.180Z"}
[2m2025-07-18T04:38:22.183136Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 154.191µs | 来源: Some(127.0.0.1:62213)
[2m2025-07-18T04:38:22.183184Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.183189Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.183199Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.196924Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.197035Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813502155_8qpulnoceui", "user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "session_id": "session_1752813502181", "user_id": "kf001", "connection_id": "ent_conn_1752813502155_t2k0ksr7tyb", "priority": "high", "timestamp": "2025-07-18T04:38:22.181Z"}
[2m2025-07-18T04:38:22.197063Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 156.013µs | 来源: Some(127.0.0.1:62215)
[2m2025-07-18T04:38:22.197103Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.197107Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.197143Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.348010Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.348171Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "user_type": "kefu", "user_id": "kf001", "quality": "high_performance", "priority": "high", "timestamp": "2025-07-18T04:38:22.344Z", "session_id": "session_1752813502344", "session": "ent_session_1752813502323_h2p6sreg7b", "connection_id": "ent_conn_1752813502323_2izpq90rpmn"}
[2m2025-07-18T04:38:22.348189Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 204.689µs | 来源: Some(127.0.0.1:62232)
[2m2025-07-18T04:38:22.348228Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.348232Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.348238Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.363462Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.363572Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "user_type": "kefu", "session": "ent_session_1752813502323_h2p6sreg7b", "session_id": "session_1752813502345", "quality": "high_performance", "user_id": "kf001", "timestamp": "2025-07-18T04:38:22.345Z", "user_name": "kf001", "connection_id": "ent_conn_1752813502323_2izpq90rpmn"}
[2m2025-07-18T04:38:22.363587Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 145.256µs | 来源: Some(127.0.0.1:62234)
[2m2025-07-18T04:38:22.363630Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.363634Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.363638Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.521107Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.521219Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "priority": "high", "quality": "high_performance", "session_id": "session_1752813502518", "user_id": "kf001", "connection_id": "ent_conn_1752813502495_n0ev9tkivm", "session": "ent_session_1752813502495_7mkzq2tuqn4", "timestamp": "2025-07-18T04:38:22.518Z", "user_type": "kefu"}
[2m2025-07-18T04:38:22.521232Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 144.025µs | 来源: Some(127.0.0.1:62245)
[2m2025-07-18T04:38:22.521274Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.521289Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.521296Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.537360Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.537467Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "connection_id": "ent_conn_1752813502495_n0ev9tkivm", "user_id": "kf001", "timestamp": "2025-07-18T04:38:22.519Z", "user_type": "kefu", "session": "ent_session_1752813502495_7mkzq2tuqn4", "session_id": "session_1752813502519", "priority": "high", "quality": "high_performance"}
[2m2025-07-18T04:38:22.537481Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 143.654µs | 来源: Some(127.0.0.1:62249)
[2m2025-07-18T04:38:22.537524Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.537528Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.537532Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.679619Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.679726Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session": "ent_session_1752813502649_v3w1konz2iq", "user_name": "kf001", "session_id": "session_1752813502671", "priority": "high", "connection_id": "ent_conn_1752813502649_4dtq2lewz58", "quality": "high_performance", "user_id": "kf001", "user_type": "kefu", "timestamp": "2025-07-18T04:38:22.671Z"}
[2m2025-07-18T04:38:22.679739Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 147.31µs | 来源: Some(127.0.0.1:62258)
[2m2025-07-18T04:38:22.679777Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.679781Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.679789Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:22.690801Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:22.690905Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "kf001", "user_name": "kf001", "connection_id": "ent_conn_1752813502649_4dtq2lewz58", "priority": "high", "session_id": "session_1752813502672", "timestamp": "2025-07-18T04:38:22.672Z", "session": "ent_session_1752813502649_v3w1konz2iq", "user_type": "kefu", "quality": "high_performance"}
[2m2025-07-18T04:38:22.690919Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 151.687µs | 来源: Some(127.0.0.1:62260)
[2m2025-07-18T04:38:22.690959Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:22.690963Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:22.690971Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:37.856620Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:37.856734Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "session": "ent_session_1752813517827_1elb6wrf15m", "session_id": "session_1752813517849", "connection_id": "ent_conn_1752813517827_ev7geoagl0i", "user_id": "kf001", "quality": "high_performance", "timestamp": "2025-07-18T04:38:37.849Z", "user_name": "kf001", "user_type": "kefu"}
[2m2025-07-18T04:38:37.856751Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 149.693µs | 来源: Some(127.0.0.1:62816)
[2m2025-07-18T04:38:37.856802Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:37.856807Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:37.856815Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:37.869585Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:37.869690Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_name": "kf001", "user_type": "kefu", "session": "ent_session_1752813517827_1elb6wrf15m", "quality": "high_performance", "priority": "high", "user_id": "kf001", "session_id": "session_1752813517850", "timestamp": "2025-07-18T04:38:37.850Z", "connection_id": "ent_conn_1752813517827_ev7geoagl0i"}
[2m2025-07-18T04:38:37.869705Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 138.706µs | 来源: Some(127.0.0.1:62818)
[2m2025-07-18T04:38:37.869747Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:37.869753Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:37.869760Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:38.103167Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:38.103280Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"connection_id": "ent_conn_1752813518076_tgvrlnltpco", "priority": "high", "session": "ent_session_1752813518076_jgkwt118xhl", "user_id": "kf001", "timestamp": "2025-07-18T04:38:38.099Z", "session_id": "session_1752813518099", "user_name": "kf001", "user_type": "kefu", "quality": "high_performance"}
[2m2025-07-18T04:38:38.103296Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 147.26µs | 来源: Some(127.0.0.1:62832)
[2m2025-07-18T04:38:38.103334Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:38.103385Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:38.103407Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:38.116634Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:38:38.116706Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813518100", "session": "ent_session_1752813518076_jgkwt118xhl", "priority": "high", "timestamp": "2025-07-18T04:38:38.100Z", "user_id": "kf001", "user_name": "kf001", "quality": "high_performance", "user_type": "kefu", "connection_id": "ent_conn_1752813518076_tgvrlnltpco"}
[2m2025-07-18T04:38:38.116741Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 123.683µs | 来源: Some(127.0.0.1:62834)
[2m2025-07-18T04:38:38.116787Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:38:38.116793Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:38:38.116799Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:38:48.963924Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:39:19.275166Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:39:26.047119Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:26.047240Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:39:26.044Z", "user_type": "kefu", "session_id": "session_1752813566044", "user_name": "kf001", "quality": "high_performance", "connection_id": "ent_conn_1752813566019_4rb1uuc1j9", "priority": "high", "user_id": "kf001", "session": "ent_session_1752813566019_vqjdc3mkyek"}
[2m2025-07-18T04:39:26.047257Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 157.646µs | 来源: Some(127.0.0.1:64923)
[2m2025-07-18T04:39:26.047303Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:39:26.047309Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:39:26.047317Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:39:26.062263Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:26.062372Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"quality": "high_performance", "timestamp": "2025-07-18T04:39:26.045Z", "user_name": "kf001", "user_id": "kf001", "session": "ent_session_1752813566019_vqjdc3mkyek", "connection_id": "ent_conn_1752813566019_4rb1uuc1j9", "priority": "high", "user_type": "kefu", "session_id": "session_1752813566045"}
[2m2025-07-18T04:39:26.062388Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 143.924µs | 来源: Some(127.0.0.1:64925)
[2m2025-07-18T04:39:26.062432Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:39:26.062438Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:39:26.062443Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:39:26.155201Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:26.155385Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"timestamp": "2025-07-18T04:39:26.152Z", "user_type": "kefu", "quality": "high_performance", "user_id": "kf001", "user_name": "kf001", "session_id": "session_1752813566152", "session": "ent_session_1752813566129_vb6679aufk", "priority": "high", "connection_id": "ent_conn_1752813566129_hsyjbgrtxib"}
[2m2025-07-18T04:39:26.155443Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 274.078µs | 来源: Some(127.0.0.1:64931)
[2m2025-07-18T04:39:26.155484Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:39:26.155489Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:39:26.155496Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:39:26.168454Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:26.168499Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "user_id": "kf001", "connection_id": "ent_conn_1752813566129_hsyjbgrtxib", "timestamp": "2025-07-18T04:39:26.153Z", "user_type": "kefu", "session_id": "session_1752813566153", "session": "ent_session_1752813566129_vb6679aufk", "user_name": "kf001", "quality": "high_performance"}
[2m2025-07-18T04:39:26.168510Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 67.064µs | 来源: Some(127.0.0.1:64934)
[2m2025-07-18T04:39:26.168536Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:39:26.168540Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:39:26.168547Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:39:26.312936Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:26.313047Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813566310", "user_id": "kf001", "quality": "high_performance", "user_type": "kefu", "session": "ent_session_1752813566287_sofb53hsmqq", "priority": "high", "user_name": "kf001", "connection_id": "ent_conn_1752813566287_2yual5cn4ts", "timestamp": "2025-07-18T04:39:26.310Z"}
[2m2025-07-18T04:39:26.313061Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 147.22µs | 来源: Some(127.0.0.1:64944)
[2m2025-07-18T04:39:26.313117Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:39:26.313121Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:39:26.313128Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:39:26.332483Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:26.332597Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"priority": "high", "session": "ent_session_1752813566287_sofb53hsmqq", "user_name": "kf001", "user_id": "kf001", "quality": "high_performance", "user_type": "kefu", "connection_id": "ent_conn_1752813566287_2yual5cn4ts", "session_id": "session_1752813566311", "timestamp": "2025-07-18T04:39:26.311Z"}
[2m2025-07-18T04:39:26.332612Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 148.491µs | 来源: Some(127.0.0.1:64951)
[2m2025-07-18T04:39:26.332668Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:39:26.332683Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:39:26.332692Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:39:40.892980Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:40.893097Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752813580873", "user_type": "kehu", "session_id": "session_1752813580890"}
[2m2025-07-18T04:39:40.893114Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 156.313µs | 来源: Some(127.0.0.1:49199)
[2m2025-07-18T04:39:40.893159Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813580873, 用户名=customer_1752813580873, 类型=Kehu
[2m2025-07-18T04:39:40.893164Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813580873, user_name=customer_1752813580873, user_type=Kehu
[2m2025-07-18T04:39:40.893173Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813580873
[2m2025-07-18T04:39:40.907893Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:40.908000Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752813580891", "user_id": "customer_1752813580873", "user_type": "kehu"}
[2m2025-07-18T04:39:40.908017Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 142.492µs | 来源: Some(127.0.0.1:49205)
[2m2025-07-18T04:39:40.908061Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813580873, 用户名=customer_1752813580873, 类型=Kehu
[2m2025-07-18T04:39:40.908067Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813580873, user_name=customer_1752813580873, user_type=Kehu
[2m2025-07-18T04:39:40.908077Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813580873
[2m2025-07-18T04:39:49.274884Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:39:51.630338Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:39:51.630473Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752813580873", "session_id": "session_1752813591627", "user_type": "kehu"}
[2m2025-07-18T04:39:51.630490Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 169.124µs | 来源: Some(127.0.0.1:49624)
[2m2025-07-18T04:39:51.630532Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752813580873, 用户名=customer_1752813580873, 类型=Kehu
[2m2025-07-18T04:39:51.630538Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752813580873, user_name=customer_1752813580873, user_type=Kehu
[2m2025-07-18T04:39:51.630546Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752813580873
[2m2025-07-18T04:40:19.268331Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:40:49.266810Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:41:18.964617Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:41:48.964952Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:42:19.274155Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:42:49.265054Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:43:19.275495Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:43:48.964224Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:44:19.265448Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:44:49.265590Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:45:19.269636Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:45:49.270905Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:46:19.266142Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:46:49.270586Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:47:19.266712Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:47:49.275494Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:48:19.268849Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:48:49.278232Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:49:19.267901Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:49:49.270305Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:50:19.276735Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:50:49.265471Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:51:11.672964Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:51:11.673101Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kefu", "session_id": "session_1752814271669", "session": "ent_session_1752813566287_sofb53hsmqq", "quality": "high_performance", "user_name": "kf001", "priority": "high", "connection_id": "ent_conn_1752813566287_2yual5cn4ts", "user_id": "kf001", "timestamp": "2025-07-18T04:51:11.669Z"}
[2m2025-07-18T04:51:11.673120Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 178.655µs | 来源: Some(127.0.0.1:50970)
[2m2025-07-18T04:51:11.673163Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:51:11.673180Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:51:11.673187Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:51:12.474480Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:51:12.474587Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752814272471", "session": "ent_session_1752812591102_mz1k5xuqb4", "quality": "high_performance", "timestamp": "2025-07-18T04:51:12.471Z", "user_name": "kf001", "priority": "high", "user_type": "kefu", "user_id": "kf001", "connection_id": "ent_conn_1752812591102_275op2qz4kt"}
[2m2025-07-18T04:51:12.474601Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 139.473µs | 来源: Some(127.0.0.1:51003)
[2m2025-07-18T04:51:12.474638Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=kf001, 用户名=kf001, 类型=Kefu
[2m2025-07-18T04:51:12.474642Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=kf001, user_name=kf001, user_type=Kefu
[2m2025-07-18T04:51:12.474646Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: kf001
[2m2025-07-18T04:51:19.275265Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:51:49.272543Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:52:06.780075Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:52:06.780186Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752814326756", "session_id": "session_1752814326775", "user_type": "kehu"}
[2m2025-07-18T04:52:06.780201Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 146.154µs | 来源: Some(127.0.0.1:52995)
[2m2025-07-18T04:52:06.780239Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814326756, 用户名=customer_1752814326756, 类型=Kehu
[2m2025-07-18T04:52:06.780245Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814326756, user_name=customer_1752814326756, user_type=Kehu
[2m2025-07-18T04:52:06.780253Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814326756
[2m2025-07-18T04:52:06.804506Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:52:06.804577Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_id": "customer_1752814326756", "session_id": "session_1752814326776", "user_type": "kehu"}
[2m2025-07-18T04:52:06.804593Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 100.444µs | 来源: Some(127.0.0.1:52998)
[2m2025-07-18T04:52:06.804626Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814326756, 用户名=customer_1752814326756, 类型=Kehu
[2m2025-07-18T04:52:06.804631Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814326756, user_name=customer_1752814326756, user_type=Kehu
[2m2025-07-18T04:52:06.804640Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814326756
[2m2025-07-18T04:52:11.886881Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:52:11.886986Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752814331868", "session_id": "session_1752814331875"}
[2m2025-07-18T04:52:11.887000Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 139.614µs | 来源: Some(127.0.0.1:53196)
[2m2025-07-18T04:52:11.887039Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814331868, 用户名=customer_1752814331868, 类型=Kehu
[2m2025-07-18T04:52:11.887043Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814331868, user_name=customer_1752814331868, user_type=Kehu
[2m2025-07-18T04:52:11.887048Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814331868
[2m2025-07-18T04:52:11.910494Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:52:11.910595Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752814331868", "session_id": "session_1752814331875"}
[2m2025-07-18T04:52:11.910607Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 130.89µs | 来源: Some(127.0.0.1:53198)
[2m2025-07-18T04:52:11.910643Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814331868, 用户名=customer_1752814331868, 类型=Kehu
[2m2025-07-18T04:52:11.910647Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814331868, user_name=customer_1752814331868, user_type=Kehu
[2m2025-07-18T04:52:11.910655Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814331868
[2m2025-07-18T04:52:19.272687Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:52:21.907768Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:52:21.907901Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752814331868", "session_id": "session_1752814341904"}
[2m2025-07-18T04:52:21.912528Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 4.774279ms | 来源: Some(127.0.0.1:53561)
[2m2025-07-18T04:52:21.912617Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814331868, 用户名=customer_1752814331868, 类型=Kehu
[2m2025-07-18T04:52:21.912624Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814331868, user_name=customer_1752814331868, user_type=Kehu
[2m2025-07-18T04:52:21.912632Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814331868
[2m2025-07-18T04:52:48.964397Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:53:18.964163Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:53:22.627745Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:22.627852Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752814402606", "session_id": "session_1752814402615"}
[2m2025-07-18T04:53:22.627876Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 152.644µs | 来源: Some(127.0.0.1:59955)
[2m2025-07-18T04:53:22.627915Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814402606, 用户名=customer_1752814402606, 类型=Kehu
[2m2025-07-18T04:53:22.627919Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814402606, user_name=customer_1752814402606, user_type=Kehu
[2m2025-07-18T04:53:22.627930Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814402606
[2m2025-07-18T04:53:22.650909Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:22.651005Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752814402616", "user_type": "kehu", "user_id": "customer_1752814402606"}
[2m2025-07-18T04:53:22.651017Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 125.533µs | 来源: Some(127.0.0.1:59957)
[2m2025-07-18T04:53:22.651056Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814402606, 用户名=customer_1752814402606, 类型=Kehu
[2m2025-07-18T04:53:22.651060Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814402606, user_name=customer_1752814402606, user_type=Kehu
[2m2025-07-18T04:53:22.651066Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814402606
[2m2025-07-18T04:53:30.672134Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:30.672338Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "session_id": "session_1752814410669", "user_id": "customer_1752814410660"}
[2m2025-07-18T04:53:30.672354Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 238.465µs | 来源: Some(127.0.0.1:60256)
[2m2025-07-18T04:53:30.672409Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814410660, 用户名=customer_1752814410660, 类型=Kehu
[2m2025-07-18T04:53:30.672414Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814410660, user_name=customer_1752814410660, user_type=Kehu
[2m2025-07-18T04:53:30.672422Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814410660
[2m2025-07-18T04:53:30.702031Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:30.702125Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "user_id": "customer_1752814410660", "session_id": "session_1752814410670"}
[2m2025-07-18T04:53:30.702140Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 124.821µs | 来源: Some(127.0.0.1:60259)
[2m2025-07-18T04:53:30.702179Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814410660, 用户名=customer_1752814410660, 类型=Kehu
[2m2025-07-18T04:53:30.702184Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814410660, user_name=customer_1752814410660, user_type=Kehu
[2m2025-07-18T04:53:30.702193Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814410660
[2m2025-07-18T04:53:37.808545Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:37.808652Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752814417793", "user_type": "kehu", "user_id": "customer_1752814417784"}
[2m2025-07-18T04:53:37.808667Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 149.519µs | 来源: Some(127.0.0.1:60531)
[2m2025-07-18T04:53:37.808713Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814417784, 用户名=customer_1752814417784, 类型=Kehu
[2m2025-07-18T04:53:37.808719Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814417784, user_name=customer_1752814417784, user_type=Kehu
[2m2025-07-18T04:53:37.808729Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814417784
[2m2025-07-18T04:53:37.824612Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:37.824717Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"session_id": "session_1752814417793", "user_id": "customer_1752814417784", "user_type": "kehu"}
[2m2025-07-18T04:53:37.824732Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 140.596µs | 来源: Some(127.0.0.1:60533)
[2m2025-07-18T04:53:37.824771Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814417784, 用户名=customer_1752814417784, 类型=Kehu
[2m2025-07-18T04:53:37.824777Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814417784, user_name=customer_1752814417784, user_type=Kehu
[2m2025-07-18T04:53:37.824787Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814417784
[2m2025-07-18T04:53:47.828120Z[0m [32m INFO[0m [2mkefu_system::routes::swagger[0m[2m:[0m 📚 API文档访问: GET /ws -> 404 Not Found
[2m2025-07-18T04:53:47.828226Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接请求: {"user_type": "kehu", "session_id": "session_1752814427824", "user_id": "customer_1752814417784"}
[2m2025-07-18T04:53:47.828241Z[0m [32m INFO[0m [2mkefu_system::server::startup[0m[2m:[0m 🔍 路由调试: GET /ws -> 状态: 101 | 耗时: 138.342µs | 来源: Some(127.0.0.1:60886)
[2m2025-07-18T04:53:47.828282Z[0m [32m INFO[0m [2mkefu_system::routes::websocket[0m[2m:[0m WebSocket连接建立: 用户ID=customer_1752814417784, 用户名=customer_1752814417784, 类型=Kehu
[2m2025-07-18T04:53:47.828287Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 🔗 开始建立WebSocket连接: user_id=customer_1752814417784, user_name=customer_1752814417784, user_type=Kehu
[2m2025-07-18T04:53:47.828293Z[0m [32m INFO[0m [2mkefu_system::websocket[0m[2m:[0m 📝 添加用户连接信息: customer_1752814417784
[2m2025-07-18T04:53:49.272048Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:54:19.276940Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:54:49.264820Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:55:19.272214Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:55:49.270075Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
[2m2025-07-18T04:56:19.267015Z[0m [32m INFO[0m [2mkefu_system::redis_pool[0m[2m:[0m Redis连接池健康检查通过 - 活跃连接: 0/8, 利用率: 0.0%
